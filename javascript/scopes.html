<!DOCTYPE html><html lang="cn"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/0b3619e1f688ca46.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0b3619e1f688ca46.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-6698976aa0ea586d.js" defer=""></script><script src="/_next/static/chunks/main-9ca4f46f71f15dad.js" defer=""></script><script src="/_next/static/chunks/pages/_app-979b2f9127ab1499.js" defer=""></script><script src="/_next/static/chunks/7a7c95a0-ab903f899792323b.js" defer=""></script><script src="/_next/static/chunks/581-340f217658a3c725.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...id%5D%5D-706fc642a67ce3cd.js" defer=""></script><script src="/_next/static/liKy-XVYAqwNYxRPCbwbr/_buildManifest.js" defer=""></script><script src="/_next/static/liKy-XVYAqwNYxRPCbwbr/_ssgManifest.js" defer=""></script></head><body class=" bg-light text-light-text dark:bg-dark dark:text-dark-text max-sm:text-sm"><script>
                (function () {
                  function setTheme(newTheme) {
                    window.__theme = newTheme;
                    if (newTheme === 'dark') {
                      document.documentElement.classList.add('dark');
                    } else if (newTheme === 'light') {
                      document.documentElement.classList.remove('dark');
                    }
                  }

                  var preferredTheme;
                  try {
                    preferredTheme = localStorage.getItem('theme');
                  } catch (err) { }

                  window.__setPreferredTheme = function(newTheme) {
                    preferredTheme = newTheme;
                    setTheme(newTheme);
                    try {
                      localStorage.setItem('theme', newTheme);
                    } catch (err) { }
                  };

                  var initialTheme = preferredTheme;
                  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                  if (!initialTheme) {
                    initialTheme = darkQuery.matches ? 'dark' : 'light';
                  }
                  setTheme(initialTheme);

                  darkQuery.addEventListener('change', function (e) {
                    if (!preferredTheme) {
                      setTheme(e.matches ? 'dark' : 'light');
                    }
                  });
                })();
              </script><div id="__next"><header class="w-full fixed t-0 h-14 border-b backdrop-blur border-slate-900/10 dark:border-slate-300/10 z-10"><div class="w-full h-full flex flex-row items-center justify-between px-4"><div>厘清逻辑</div><div class="mr-2 flex flex-row items-center justify-between gap-2 text-xl"><a href="https://github.com/Xxs-7/Xxs-7.github.io" class="p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><button class="block dark:hidden p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5" type="button" aria-label="Use Dark Mode"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"></path></svg></button><button type="button" class="hidden dark:block p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5" aria-label="Use Light Mode"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79zM1 10.5h3v2H1zM11 .55h2V3.5h-2zm8.04 2.495l1.408 1.407-1.79 1.79-1.407-1.408zm-1.8 15.115l1.79 1.8 1.41-1.41-1.8-1.79zM20 10.5h3v2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm-1 4h2v2.95h-2zm-7.45-.96l1.41 1.41 1.79-1.8-1.41-1.41z"></path></svg></button></div></div></header><div class="pt-14 flex max-w-screen overflow-y-scroll"><nav class="hidden lg:block fixed top-14 lg:bottom-0 lg:h-screen w-[18rem] pb-10 pl-4 overflow-y-auto min-h-screen z-10"><nav><ul class="mt-6 mb-12"><!--$--><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">html</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/html/SemanticsTag">语义化标签</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/html/anchor">锚元素</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">css</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/flex">flex 布局</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/grid">grid 布局</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/unit">布局单位</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/stacking-context">层叠上下文</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">javascript</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/javascript/promise">promise</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/javascript/async-await">async 和 await</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/javascript/execution-context">执行上下文</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5 text-highlight"><a class="block" href="/javascript/scopes">作用域</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">react</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/roadmap">学习路线</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/lifecycle">类组件生命周期</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/hook">hook</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/high-compoment">组件逻辑复用方案</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">react 源码</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/architecture">源码架构</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/fiber-node">fiber 节点</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/render-mode">渲染模式</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/execution-context">context</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/scheduler">scheduler</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/first-render">初次渲染</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/update-render">更新渲染</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/render-task">渲染任务的执行</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/reconcile">reconcile</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">实践</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/demo/music-player">音乐播放器</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/demo/font-advance">字体库优化</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">资料</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/material/roadmap">路线图</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">遐想</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/opinion/blog">博客</a></li></ul></li><!--/$--></ul></nav></nav><main class="relative lg:ml-[18rem] min-w-0 flex-1 pl-1 pr-5 pb-6"><article class="mx-auto xl:max-w-none overflow-x-hidden xl:ml-0 xl:mr-[18rem]"><h1 class="mdx-heading text-3xl font-extrabold my-6 text-header dark:text-header-dark" id="作用域">作用域</h1>
<blockquote class="border-l-2 border-current border-solid py-2 px-4 my-2 shadow-inner bg-[rgba(135,131,120,0.15)] dark:bg-highlight-dark bg-opacity-50 flex relative"><span class="block relative">
<p class="whitespace-pre-wrap my-2 ">The scope is the current context of execution in which values and expressions are &quot;visible&quot; or can be referenced.</p>
</span></blockquote>
<p class="whitespace-pre-wrap my-2 ">作用域 scope 是指在代码定义变量的区域内，<strong class="font-bold">拥有对变量的访问权限</strong>。</p>
<p class="whitespace-pre-wrap my-2 ">在 javascript中，采取的是静态作用域。</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed ">静态作用域：函数的作用域在函数<strong class="font-bold">定义</strong>的时候就决定了。</li>
<li class="leading-relaxed ">动态作用域：函数的作用域在函数调用时才决定的。</li>
</ul>
<p class="whitespace-pre-wrap my-2 ">JavaScript 的作用域分以下三种：</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed ">全局作用域：脚本模式运行所有代码的默认作用域</li>
<li class="leading-relaxed ">模块作用域：模块模式中运行代码的作用域</li>
<li class="leading-relaxed ">函数作用域：由函数创建的作用域</li>
</ul>
<p class="whitespace-pre-wrap my-2 ">此外，用 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">let</code> 或 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">const</code> 声明的变量属于额外的作用域：</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed ">块级作用域：用一对花括号（一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/block" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">代码块</a>）创建出来的作用域</li>
</ul>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="作用域链">作用域链<a href="#作用域链" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">具体来说，每当进入一个新的词法环境（例如一个函数）时，就会形成一个新的作用域链，该作用域链是由当前环境的变量对象和其外部环境的作用域链组成。</p>
<p class="whitespace-pre-wrap my-2 ">因此，词法环境和作用域的主要区别在于，词法环境表示了在代码中变量和函数声明的位置，而作用域则表示了在运行时哪些变量和函数可以被访问到。但两者紧密相关，<strong class="font-bold">因为词法环境定义了作用域链的结构</strong>，从而影响了作用域的查找过程。</p>
<p class="whitespace-pre-wrap my-2 ">每一个函数都有一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> 属性，其存储的是这个函数运行时的作用域链，除了当前函数的作用域，作用域链的其他部分都会在其父函数预编译时添加到函数的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> 属性上（因为父函数也需要预编译后才能确定自己的词法环境）</p>
<pre><!--$--><div class="prism-code language-js rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">test</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">console</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">dir</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">test</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// ƒ test()</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// arguments: null</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// caller: null</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// length: 0</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// name: &quot;test&quot;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// prototype: {constructor: ƒ}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// [[FunctionLocation]]: VM495:1</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// [[Prototype]]: ƒ ()</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// [[Scopes]]: Scopes[1]</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">这里的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> 是给 JS 引擎用的，控制台拿不到其值的。存放了函数被创建的作用域中对象的集合。
作用域是在代码预编译时产生的，先有词法环境且来源于它。</p>
<p class="whitespace-pre-wrap my-2 ">当 V8 预编译一个函数时，<strong class="font-bold">如果遇到内部函数的定义不会选择跳过，而是会快速的扫描这个内部函数中使用到的本函数词法环境中的变量</strong>，**然后将这些变量的引用加入 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code> 对象，**再来为这个内部函数函数绑定 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> ，并且使用当前函数的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code> 作为内部函数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> 的一部分。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>跟 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code>一样会在函数预编译时被确定，区别是当前函数的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code>是在其父函数预编译时确定， 而 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>是在当前函数预编译时确定（在当前函数执行上下文创建完成入栈后就开始创建 Closure 了）。</p>
<blockquote class="border-l-2 border-current border-solid py-2 px-4 my-2 shadow-inner bg-[rgba(135,131,120,0.15)] dark:bg-highlight-dark bg-opacity-50 flex relative"><span class="block relative">
<p class="whitespace-pre-wrap my-2 ">注意：每一次遇到内部声明的函数/方法时都会这么做，无论其内部函数/方法的声明嵌套有多深，并且他们使用的都是同一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>对象。并且这个过程 <strong class="font-bold">是在预编译时进行的而不是在函数运行时</strong></p>
</span></blockquote>
<h3 class="mdx-heading text-xl font-semibold whitespace-pre-wrap mt-4 mb-2 group text-header dark:text-header-dark" id="作用域的就近原则">作用域的就近原则<a href="#作用域的就近原则" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h3>
<p class="whitespace-pre-wrap my-2 ">每一个函数的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code> 中都存在当前函数的词法环境和上级函数的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">[[Scopes]]</code>。在函数运行时会优先取距离当前函数词法环境最近的变量值</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="闭包">闭包<a href="#闭包" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">简单来说就是函数已经从执行上下文栈弹出了，销毁了，但是依然能访问到之前销毁的变量（也就是内存没有被回收）。这样的函数就是闭包。</p>
<p class="whitespace-pre-wrap my-2 ">每一个函数在执行之前都会进行预编译，预编译时会创建一个空的<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>对象。</p>
<p class="whitespace-pre-wrap my-2 ">每当这个函数预编译时遇到其内部的函数声明时，会快速的扫描内部函数使用了当前函数中的哪些变量，将可能使用到的变量加入到<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>对象中，最终这个<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code>对象将作为这些内部函数作用域链中的一员。</p>
<p class="whitespace-pre-wrap my-2 ">只有所有内部函数的作用域链都被释放才会释放当前函数的闭包对象，所谓的闭包内存泄漏也就是因为闭包对象无法释放产生的。</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="内存泄漏案例分析">内存泄漏案例分析<a href="#内存泄漏案例分析" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> theThing </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">replaceThing</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> leak </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> theThing</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">unused</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">        </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">leak</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    theThing </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap">  </span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">        </span><span class="whitespace-pre-wrap">longStr</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Array</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">1000000</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">        </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">someMethod</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap">  </span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">        </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> index </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">0</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">index </span><span class="whitespace-pre-wrap">&lt;</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">100</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">replaceThing</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    index</span><span class="whitespace-pre-wrap">++</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">重点在于 replaceThing 的闭包分析</p>
<p class="whitespace-pre-wrap my-2 ">执行 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">replaceThing()</code> ， <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">let leak = theThing;</code> 语句导致函数上下文的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code> 包含对 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">theThing</code> 的闭包引用，然后 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">theThing</code> 变成一个大对象。</p>
<p class="whitespace-pre-wrap my-2 ">再次执行 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">replaceThing()</code> ，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">leak</code> 赋值上一次执行生成的大对象，导致本次 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code> 对上次的闭包不能释放，然后 theThing 又重新生成大对象。</p>
<p class="whitespace-pre-wrap my-2 ">循环往复，每一次执行的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">replaceThing()</code> 生成的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Closure</code> 都不能被释放，导致内存泄漏</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="参考资料">参考资料<a href="#参考资料" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 "><a href="https://developer.mozilla.org/en-US/docs/Glossary/Scope" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">https://developer.mozilla.org/en-US/docs/Glossary/Scope</a>
<a href="https://juejin.cn/post/7022537890114568205" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">https://juejin.cn/post/7022537890114568205</a></p></article><aside class="hidden xl:block fixed top-14 right-0 w-[18rem] py-6 overflow-y-auto"><ul class="text-sm font-medium"><li class="pl-2 text-base">作用域</li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#作用域链" class="block py-1">作用域链</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-6 text-xs"><a href="#作用域的就近原则" class="block py-1">作用域的就近原则</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#闭包" class="block py-1">闭包</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#内存泄漏案例分析" class="block py-1">内存泄漏案例分析</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#参考资料" class="block py-1">参考资料</a></li></ul></aside></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"toc":[{"text":"作用域","hash":"#作用域","depth":1},{"text":"作用域链","hash":"#作用域链","depth":2},{"text":"作用域的就近原则","hash":"#作用域的就近原则","depth":3},{"text":"闭包","hash":"#闭包","depth":2},{"text":"内存泄漏案例分析","hash":"#内存泄漏案例分析","depth":2},{"text":"参考资料","hash":"#参考资料","depth":2}],"code":"var Component=(()=\u003e{var p=Object.create;var h=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var m=(c,e)=\u003e()=\u003e(e||c((e={exports:{}}).exports,e),e.exports),f=(c,e)=\u003e{for(var l in e)h(c,l,{get:e[l],enumerable:!0})},d=(c,e,l,i)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let r of u(e))!S.call(c,r)\u0026\u0026r!==l\u0026\u0026h(c,r,{get:()=\u003ee[r],enumerable:!(i=a(e,r))||i.enumerable});return c};var x=(c,e,l)=\u003e(l=c!=null?p(g(c)):{},d(e||!c||!c.__esModule?h(l,\"default\",{value:c,enumerable:!0}):l,c)),C=c=\u003ed(h({},\"__esModule\",{value:!0}),c);var t=m((v,o)=\u003e{o.exports=_jsx_runtime});var b={};f(b,{default:()=\u003eT});var n=x(t());function s(c){let e=Object.assign({h1:\"h1\",blockquote:\"blockquote\",p:\"p\",strong:\"strong\",ul:\"ul\",li:\"li\",code:\"code\",a:\"a\",h2:\"h2\",pre:\"pre\",h3:\"h3\"},c.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{hash:\"\\u4F5C\\u7528\\u57DF\",children:\"\\u4F5C\\u7528\\u57DF\"}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:'The scope is the current context of execution in which values and expressions are \"visible\" or can be referenced.'}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u4F5C\\u7528\\u57DF scope \\u662F\\u6307\\u5728\\u4EE3\\u7801\\u5B9A\\u4E49\\u53D8\\u91CF\\u7684\\u533A\\u57DF\\u5185\\uFF0C\",(0,n.jsx)(e.strong,{children:\"\\u62E5\\u6709\\u5BF9\\u53D8\\u91CF\\u7684\\u8BBF\\u95EE\\u6743\\u9650\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5728 javascript\\u4E2D\\uFF0C\\u91C7\\u53D6\\u7684\\u662F\\u9759\\u6001\\u4F5C\\u7528\\u57DF\\u3002\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u9759\\u6001\\u4F5C\\u7528\\u57DF\\uFF1A\\u51FD\\u6570\\u7684\\u4F5C\\u7528\\u57DF\\u5728\\u51FD\\u6570\",(0,n.jsx)(e.strong,{children:\"\\u5B9A\\u4E49\"}),\"\\u7684\\u65F6\\u5019\\u5C31\\u51B3\\u5B9A\\u4E86\\u3002\"]}),`\n`,(0,n.jsx)(e.li,{children:\"\\u52A8\\u6001\\u4F5C\\u7528\\u57DF\\uFF1A\\u51FD\\u6570\\u7684\\u4F5C\\u7528\\u57DF\\u5728\\u51FD\\u6570\\u8C03\\u7528\\u65F6\\u624D\\u51B3\\u5B9A\\u7684\\u3002\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"JavaScript \\u7684\\u4F5C\\u7528\\u57DF\\u5206\\u4EE5\\u4E0B\\u4E09\\u79CD\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u5168\\u5C40\\u4F5C\\u7528\\u57DF\\uFF1A\\u811A\\u672C\\u6A21\\u5F0F\\u8FD0\\u884C\\u6240\\u6709\\u4EE3\\u7801\\u7684\\u9ED8\\u8BA4\\u4F5C\\u7528\\u57DF\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u6A21\\u5757\\u4F5C\\u7528\\u57DF\\uFF1A\\u6A21\\u5757\\u6A21\\u5F0F\\u4E2D\\u8FD0\\u884C\\u4EE3\\u7801\\u7684\\u4F5C\\u7528\\u57DF\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u51FD\\u6570\\u4F5C\\u7528\\u57DF\\uFF1A\\u7531\\u51FD\\u6570\\u521B\\u5EFA\\u7684\\u4F5C\\u7528\\u57DF\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6B64\\u5916\\uFF0C\\u7528\\xA0\",(0,n.jsx)(e.code,{children:\"let\"}),\"\\xA0\\u6216\\xA0\",(0,n.jsx)(e.code,{children:\"const\"}),\"\\xA0\\u58F0\\u660E\\u7684\\u53D8\\u91CF\\u5C5E\\u4E8E\\u989D\\u5916\\u7684\\u4F5C\\u7528\\u57DF\\uFF1A\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u5757\\u7EA7\\u4F5C\\u7528\\u57DF\\uFF1A\\u7528\\u4E00\\u5BF9\\u82B1\\u62EC\\u53F7\\uFF08\\u4E00\\u4E2A\",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/block\",children:\"\\u4EE3\\u7801\\u5757\"}),\"\\uFF09\\u521B\\u5EFA\\u51FA\\u6765\\u7684\\u4F5C\\u7528\\u57DF\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4F5C\\u7528\\u57DF\\u94FE\",children:\"\\u4F5C\\u7528\\u57DF\\u94FE\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5177\\u4F53\\u6765\\u8BF4\\uFF0C\\u6BCF\\u5F53\\u8FDB\\u5165\\u4E00\\u4E2A\\u65B0\\u7684\\u8BCD\\u6CD5\\u73AF\\u5883\\uFF08\\u4F8B\\u5982\\u4E00\\u4E2A\\u51FD\\u6570\\uFF09\\u65F6\\uFF0C\\u5C31\\u4F1A\\u5F62\\u6210\\u4E00\\u4E2A\\u65B0\\u7684\\u4F5C\\u7528\\u57DF\\u94FE\\uFF0C\\u8BE5\\u4F5C\\u7528\\u57DF\\u94FE\\u662F\\u7531\\u5F53\\u524D\\u73AF\\u5883\\u7684\\u53D8\\u91CF\\u5BF9\\u8C61\\u548C\\u5176\\u5916\\u90E8\\u73AF\\u5883\\u7684\\u4F5C\\u7528\\u57DF\\u94FE\\u7EC4\\u6210\\u3002\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u56E0\\u6B64\\uFF0C\\u8BCD\\u6CD5\\u73AF\\u5883\\u548C\\u4F5C\\u7528\\u57DF\\u7684\\u4E3B\\u8981\\u533A\\u522B\\u5728\\u4E8E\\uFF0C\\u8BCD\\u6CD5\\u73AF\\u5883\\u8868\\u793A\\u4E86\\u5728\\u4EE3\\u7801\\u4E2D\\u53D8\\u91CF\\u548C\\u51FD\\u6570\\u58F0\\u660E\\u7684\\u4F4D\\u7F6E\\uFF0C\\u800C\\u4F5C\\u7528\\u57DF\\u5219\\u8868\\u793A\\u4E86\\u5728\\u8FD0\\u884C\\u65F6\\u54EA\\u4E9B\\u53D8\\u91CF\\u548C\\u51FD\\u6570\\u53EF\\u4EE5\\u88AB\\u8BBF\\u95EE\\u5230\\u3002\\u4F46\\u4E24\\u8005\\u7D27\\u5BC6\\u76F8\\u5173\\uFF0C\",(0,n.jsx)(e.strong,{children:\"\\u56E0\\u4E3A\\u8BCD\\u6CD5\\u73AF\\u5883\\u5B9A\\u4E49\\u4E86\\u4F5C\\u7528\\u57DF\\u94FE\\u7684\\u7ED3\\u6784\"}),\"\\uFF0C\\u4ECE\\u800C\\u5F71\\u54CD\\u4E86\\u4F5C\\u7528\\u57DF\\u7684\\u67E5\\u627E\\u8FC7\\u7A0B\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6BCF\\u4E00\\u4E2A\\u51FD\\u6570\\u90FD\\u6709\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\" \\u5C5E\\u6027\\uFF0C\\u5176\\u5B58\\u50A8\\u7684\\u662F\\u8FD9\\u4E2A\\u51FD\\u6570\\u8FD0\\u884C\\u65F6\\u7684\\u4F5C\\u7528\\u57DF\\u94FE\\uFF0C\\u9664\\u4E86\\u5F53\\u524D\\u51FD\\u6570\\u7684\\u4F5C\\u7528\\u57DF\\uFF0C\\u4F5C\\u7528\\u57DF\\u94FE\\u7684\\u5176\\u4ED6\\u90E8\\u5206\\u90FD\\u4F1A\\u5728\\u5176\\u7236\\u51FD\\u6570\\u9884\\u7F16\\u8BD1\\u65F6\\u6DFB\\u52A0\\u5230\\u51FD\\u6570\\u7684 \",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\" \\u5C5E\\u6027\\u4E0A\\uFF08\\u56E0\\u4E3A\\u7236\\u51FD\\u6570\\u4E5F\\u9700\\u8981\\u9884\\u7F16\\u8BD1\\u540E\\u624D\\u80FD\\u786E\\u5B9A\\u81EA\\u5DF1\\u7684\\u8BCD\\u6CD5\\u73AF\\u5883\\uFF09\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`function test() { }\n\nconsole.dir(test);\n// \\u0192 test()\n// arguments: null\n// caller: null\n// length: 0\n// name: \"test\"\n// prototype: {constructor: \\u0192}\n// [[FunctionLocation]]: VM495:1\n// [[Prototype]]: \\u0192 ()\n// [[Scopes]]: Scopes[1]\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8FD9\\u91CC\\u7684 \",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),` \\u662F\\u7ED9 JS \\u5F15\\u64CE\\u7528\\u7684\\uFF0C\\u63A7\\u5236\\u53F0\\u62FF\\u4E0D\\u5230\\u5176\\u503C\\u7684\\u3002\\u5B58\\u653E\\u4E86\\u51FD\\u6570\\u88AB\\u521B\\u5EFA\\u7684\\u4F5C\\u7528\\u57DF\\u4E2D\\u5BF9\\u8C61\\u7684\\u96C6\\u5408\\u3002\n\\u4F5C\\u7528\\u57DF\\u662F\\u5728\\u4EE3\\u7801\\u9884\\u7F16\\u8BD1\\u65F6\\u4EA7\\u751F\\u7684\\uFF0C\\u5148\\u6709\\u8BCD\\u6CD5\\u73AF\\u5883\\u4E14\\u6765\\u6E90\\u4E8E\\u5B83\\u3002`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5F53 V8 \\u9884\\u7F16\\u8BD1\\u4E00\\u4E2A\\u51FD\\u6570\\u65F6\\uFF0C\",(0,n.jsx)(e.strong,{children:\"\\u5982\\u679C\\u9047\\u5230\\u5185\\u90E8\\u51FD\\u6570\\u7684\\u5B9A\\u4E49\\u4E0D\\u4F1A\\u9009\\u62E9\\u8DF3\\u8FC7\\uFF0C\\u800C\\u662F\\u4F1A\\u5FEB\\u901F\\u7684\\u626B\\u63CF\\u8FD9\\u4E2A\\u5185\\u90E8\\u51FD\\u6570\\u4E2D\\u4F7F\\u7528\\u5230\\u7684\\u672C\\u51FD\\u6570\\u8BCD\\u6CD5\\u73AF\\u5883\\u4E2D\\u7684\\u53D8\\u91CF\"}),\"\\uFF0C**\\u7136\\u540E\\u5C06\\u8FD9\\u4E9B\\u53D8\\u91CF\\u7684\\u5F15\\u7528\\u52A0\\u5165 \",(0,n.jsx)(e.code,{children:\"Closure\"}),\" \\u5BF9\\u8C61\\uFF0C**\\u518D\\u6765\\u4E3A\\u8FD9\\u4E2A\\u5185\\u90E8\\u51FD\\u6570\\u51FD\\u6570\\u7ED1\\u5B9A \",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\" \\uFF0C\\u5E76\\u4E14\\u4F7F\\u7528\\u5F53\\u524D\\u51FD\\u6570\\u7684 \",(0,n.jsx)(e.code,{children:\"Closure\"}),\" \\u4F5C\\u4E3A\\u5185\\u90E8\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\" \\u7684\\u4E00\\u90E8\\u5206\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u8DDF\\xA0\",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\"\\u4E00\\u6837\\u4F1A\\u5728\\u51FD\\u6570\\u9884\\u7F16\\u8BD1\\u65F6\\u88AB\\u786E\\u5B9A\\uFF0C\\u533A\\u522B\\u662F\\u5F53\\u524D\\u51FD\\u6570\\u7684\\xA0\",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\"\\u662F\\u5728\\u5176\\u7236\\u51FD\\u6570\\u9884\\u7F16\\u8BD1\\u65F6\\u786E\\u5B9A\\uFF0C \\u800C\\xA0\",(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u662F\\u5728\\u5F53\\u524D\\u51FD\\u6570\\u9884\\u7F16\\u8BD1\\u65F6\\u786E\\u5B9A\\uFF08\\u5728\\u5F53\\u524D\\u51FD\\u6570\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u521B\\u5EFA\\u5B8C\\u6210\\u5165\\u6808\\u540E\\u5C31\\u5F00\\u59CB\\u521B\\u5EFA Closure \\u4E86\\uFF09\\u3002\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6CE8\\u610F\\uFF1A\\u6BCF\\u4E00\\u6B21\\u9047\\u5230\\u5185\\u90E8\\u58F0\\u660E\\u7684\\u51FD\\u6570/\\u65B9\\u6CD5\\u65F6\\u90FD\\u4F1A\\u8FD9\\u4E48\\u505A\\uFF0C\\u65E0\\u8BBA\\u5176\\u5185\\u90E8\\u51FD\\u6570/\\u65B9\\u6CD5\\u7684\\u58F0\\u660E\\u5D4C\\u5957\\u6709\\u591A\\u6DF1\\uFF0C\\u5E76\\u4E14\\u4ED6\\u4EEC\\u4F7F\\u7528\\u7684\\u90FD\\u662F\\u540C\\u4E00\\u4E2A\\xA0\",(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u5BF9\\u8C61\\u3002\\u5E76\\u4E14\\u8FD9\\u4E2A\\u8FC7\\u7A0B\\xA0\",(0,n.jsx)(e.strong,{children:\"\\u662F\\u5728\\u9884\\u7F16\\u8BD1\\u65F6\\u8FDB\\u884C\\u7684\\u800C\\u4E0D\\u662F\\u5728\\u51FD\\u6570\\u8FD0\\u884C\\u65F6\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u4F5C\\u7528\\u57DF\\u7684\\u5C31\\u8FD1\\u539F\\u5219\",children:\"\\u4F5C\\u7528\\u57DF\\u7684\\u5C31\\u8FD1\\u539F\\u5219\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6BCF\\u4E00\\u4E2A\\u51FD\\u6570\\u7684\\xA0\",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\"\\xA0\\u4E2D\\u90FD\\u5B58\\u5728\\u5F53\\u524D\\u51FD\\u6570\\u7684\\u8BCD\\u6CD5\\u73AF\\u5883\\u548C\\u4E0A\\u7EA7\\u51FD\\u6570\\u7684\\xA0\",(0,n.jsx)(e.code,{children:\"[[Scopes]]\"}),\"\\u3002\\u5728\\u51FD\\u6570\\u8FD0\\u884C\\u65F6\\u4F1A\\u4F18\\u5148\\u53D6\\u8DDD\\u79BB\\u5F53\\u524D\\u51FD\\u6570\\u8BCD\\u6CD5\\u73AF\\u5883\\u6700\\u8FD1\\u7684\\u53D8\\u91CF\\u503C\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u95ED\\u5305\",children:\"\\u95ED\\u5305\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u7B80\\u5355\\u6765\\u8BF4\\u5C31\\u662F\\u51FD\\u6570\\u5DF2\\u7ECF\\u4ECE\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u6808\\u5F39\\u51FA\\u4E86\\uFF0C\\u9500\\u6BC1\\u4E86\\uFF0C\\u4F46\\u662F\\u4F9D\\u7136\\u80FD\\u8BBF\\u95EE\\u5230\\u4E4B\\u524D\\u9500\\u6BC1\\u7684\\u53D8\\u91CF\\uFF08\\u4E5F\\u5C31\\u662F\\u5185\\u5B58\\u6CA1\\u6709\\u88AB\\u56DE\\u6536\\uFF09\\u3002\\u8FD9\\u6837\\u7684\\u51FD\\u6570\\u5C31\\u662F\\u95ED\\u5305\\u3002\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6BCF\\u4E00\\u4E2A\\u51FD\\u6570\\u5728\\u6267\\u884C\\u4E4B\\u524D\\u90FD\\u4F1A\\u8FDB\\u884C\\u9884\\u7F16\\u8BD1\\uFF0C\\u9884\\u7F16\\u8BD1\\u65F6\\u4F1A\\u521B\\u5EFA\\u4E00\\u4E2A\\u7A7A\\u7684\",(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u5BF9\\u8C61\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6BCF\\u5F53\\u8FD9\\u4E2A\\u51FD\\u6570\\u9884\\u7F16\\u8BD1\\u65F6\\u9047\\u5230\\u5176\\u5185\\u90E8\\u7684\\u51FD\\u6570\\u58F0\\u660E\\u65F6\\uFF0C\\u4F1A\\u5FEB\\u901F\\u7684\\u626B\\u63CF\\u5185\\u90E8\\u51FD\\u6570\\u4F7F\\u7528\\u4E86\\u5F53\\u524D\\u51FD\\u6570\\u4E2D\\u7684\\u54EA\\u4E9B\\u53D8\\u91CF\\uFF0C\\u5C06\\u53EF\\u80FD\\u4F7F\\u7528\\u5230\\u7684\\u53D8\\u91CF\\u52A0\\u5165\\u5230\",(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u5BF9\\u8C61\\u4E2D\\uFF0C\\u6700\\u7EC8\\u8FD9\\u4E2A\",(0,n.jsx)(e.code,{children:\"Closure\"}),\"\\u5BF9\\u8C61\\u5C06\\u4F5C\\u4E3A\\u8FD9\\u4E9B\\u5185\\u90E8\\u51FD\\u6570\\u4F5C\\u7528\\u57DF\\u94FE\\u4E2D\\u7684\\u4E00\\u5458\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u53EA\\u6709\\u6240\\u6709\\u5185\\u90E8\\u51FD\\u6570\\u7684\\u4F5C\\u7528\\u57DF\\u94FE\\u90FD\\u88AB\\u91CA\\u653E\\u624D\\u4F1A\\u91CA\\u653E\\u5F53\\u524D\\u51FD\\u6570\\u7684\\u95ED\\u5305\\u5BF9\\u8C61\\uFF0C\\u6240\\u8C13\\u7684\\u95ED\\u5305\\u5185\\u5B58\\u6CC4\\u6F0F\\u4E5F\\u5C31\\u662F\\u56E0\\u4E3A\\u95ED\\u5305\\u5BF9\\u8C61\\u65E0\\u6CD5\\u91CA\\u653E\\u4EA7\\u751F\\u7684\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u5185\\u5B58\\u6CC4\\u6F0F\\u6848\\u4F8B\\u5206\\u6790\",children:\"\\u5185\\u5B58\\u6CC4\\u6F0F\\u6848\\u4F8B\\u5206\\u6790\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`let theThing = null;\nlet replaceThing = function () {\n    let leak = theThing;\n    function unused () { \n        if (leak){}\n    };\n\n    theThing = {  \n        longStr: new Array(1000000),\n        someMethod: function () {  \n        }\n    };\n};\n\nlet index = 0;\nwhile(index \u003c 100){\n    replaceThing()\n    index++;\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u91CD\\u70B9\\u5728\\u4E8E replaceThing \\u7684\\u95ED\\u5305\\u5206\\u6790\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6267\\u884C \",(0,n.jsx)(e.code,{children:\"replaceThing()\"}),\" \\uFF0C \",(0,n.jsx)(e.code,{children:\"let leak = theThing;\"}),\" \\u8BED\\u53E5\\u5BFC\\u81F4\\u51FD\\u6570\\u4E0A\\u4E0B\\u6587\\u7684 \",(0,n.jsx)(e.code,{children:\"Closure\"}),\" \\u5305\\u542B\\u5BF9 \",(0,n.jsx)(e.code,{children:\"theThing\"}),\" \\u7684\\u95ED\\u5305\\u5F15\\u7528\\uFF0C\\u7136\\u540E \",(0,n.jsx)(e.code,{children:\"theThing\"}),\" \\u53D8\\u6210\\u4E00\\u4E2A\\u5927\\u5BF9\\u8C61\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u518D\\u6B21\\u6267\\u884C \",(0,n.jsx)(e.code,{children:\"replaceThing()\"}),\" \\uFF0C\",(0,n.jsx)(e.code,{children:\"leak\"}),\" \\u8D4B\\u503C\\u4E0A\\u4E00\\u6B21\\u6267\\u884C\\u751F\\u6210\\u7684\\u5927\\u5BF9\\u8C61\\uFF0C\\u5BFC\\u81F4\\u672C\\u6B21 \",(0,n.jsx)(e.code,{children:\"Closure\"}),\" \\u5BF9\\u4E0A\\u6B21\\u7684\\u95ED\\u5305\\u4E0D\\u80FD\\u91CA\\u653E\\uFF0C\\u7136\\u540E theThing \\u53C8\\u91CD\\u65B0\\u751F\\u6210\\u5927\\u5BF9\\u8C61\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5FAA\\u73AF\\u5F80\\u590D\\uFF0C\\u6BCF\\u4E00\\u6B21\\u6267\\u884C\\u7684 \",(0,n.jsx)(e.code,{children:\"replaceThing()\"}),\" \\u751F\\u6210\\u7684 \",(0,n.jsx)(e.code,{children:\"Closure\"}),\" \\u90FD\\u4E0D\\u80FD\\u88AB\\u91CA\\u653E\\uFF0C\\u5BFC\\u81F4\\u5185\\u5B58\\u6CC4\\u6F0F\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u53C2\\u8003\\u8D44\\u6599\",children:\"\\u53C2\\u8003\\u8D44\\u6599\"}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Glossary/Scope\",children:\"https://developer.mozilla.org/en-US/docs/Glossary/Scope\"}),`\n`,(0,n.jsx)(e.a,{href:\"https://juejin.cn/post/7022537890114568205\",children:\"https://juejin.cn/post/7022537890114568205\"})]})]})}function j(c={}){let{wrapper:e}=c.components||{};return e?(0,n.jsx)(e,Object.assign({},c,{children:(0,n.jsx)(s,c)})):s(c)}var T=j;return C(b);})();\n;return Component;"},"__N_SSG":true},"page":"/[[...id]]","query":{"id":["javascript","scopes"]},"buildId":"liKy-XVYAqwNYxRPCbwbr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>