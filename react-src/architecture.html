<!DOCTYPE html><html lang="cn"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/media/62122003a050e1bd-s.p.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/aceb6d5e7704f218-s.p.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/ae31b57542b06250.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ae31b57542b06250.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-6698976aa0ea586d.js" defer=""></script><script src="/_next/static/chunks/main-9ca4f46f71f15dad.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a08fec001b3e2b97.js" defer=""></script><script src="/_next/static/chunks/7a7c95a0-ab903f899792323b.js" defer=""></script><script src="/_next/static/chunks/581-340f217658a3c725.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...id%5D%5D-9e513b1713de17be.js" defer=""></script><script src="/_next/static/1n3RON42eWQmN0ceCWFd0/_buildManifest.js" defer=""></script><script src="/_next/static/1n3RON42eWQmN0ceCWFd0/_ssgManifest.js" defer=""></script></head><body class=" bg-light text-light-text dark:bg-dark dark:text-dark-text max-sm:text-sm"><script>
                (function () {
                  function setTheme(newTheme) {
                    window.__theme = newTheme;
                    if (newTheme === 'dark') {
                      document.documentElement.classList.add('dark');
                    } else if (newTheme === 'light') {
                      document.documentElement.classList.remove('dark');
                    }
                  }

                  var preferredTheme;
                  try {
                    preferredTheme = localStorage.getItem('theme');
                  } catch (err) { }

                  window.__setPreferredTheme = function(newTheme) {
                    preferredTheme = newTheme;
                    setTheme(newTheme);
                    try {
                      localStorage.setItem('theme', newTheme);
                    } catch (err) { }
                  };

                  var initialTheme = preferredTheme;
                  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                  if (!initialTheme) {
                    initialTheme = darkQuery.matches ? 'dark' : 'light';
                  }
                  setTheme(initialTheme);

                  darkQuery.addEventListener('change', function (e) {
                    if (!preferredTheme) {
                      setTheme(e.matches ? 'dark' : 'light');
                    }
                  });
                })();
              </script><div id="__next"><div class="__className_118c38"><header class="w-full fixed t-0 h-14 border-b backdrop-blur border-slate-900/10 dark:border-slate-300/10 z-10"><div class="w-full h-full flex flex-row items-center justify-between px-4"><div>BLOG</div><div class="p-1 mr-2 flex flex-row rounded-full items-center justify-between hover:bg-dark/5 hover:dark:bg-light/5"><button class="block dark:hidden" type="button" aria-label="Use Dark Mode"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" stroke="currentColor"><title>moon</title><path fill="currentColor" d="M15.505 16.496c-1.97-1.971-2.499-4.819-1.626-7.284-0.953 0.337-1.854 0.865-2.616 1.626-2.734 2.734-2.734 7.167 0 9.9 2.733 2.733 7.164 2.735 9.898 0 0.764-0.762 1.29-1.663 1.626-2.616-2.463 0.872-5.312 0.344-7.283-1.626z"></path></svg></button><button type="button" class="hidden dark:block" aria-label="Use Light Mode"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" stroke="currentColor"><title>sun</title><path fill="currentColor" d="M16 9c-3.859 0-7 3.141-7 7s3.141 7 7 7 7-3.141 7-7c0-3.859-3.141-7-7-7zM16 21c-2.762 0-5-2.238-5-5s2.238-5 5-5 5 2.238 5 5-2.238 5-5 5zM16 7c0.552 0 1-0.448 1-1v-2c0-0.552-0.448-1-1-1s-1 0.448-1 1v2c0 0.552 0.448 1 1 1zM16 25c-0.552 0-1 0.448-1 1v2c0 0.552 0.448 1 1 1s1-0.448 1-1v-2c0-0.552-0.448-1-1-1zM23.777 9.635l1.414-1.414c0.391-0.391 0.391-1.023 0-1.414s-1.023-0.391-1.414 0l-1.414 1.414c-0.391 0.391-0.391 1.023 0 1.414s1.023 0.391 1.414 0zM8.223 22.365l-1.414 1.414c-0.391 0.391-0.391 1.023 0 1.414s1.023 0.391 1.414 0l1.414-1.414c0.391-0.392 0.391-1.023 0-1.414s-1.023-0.392-1.414 0zM7 16c0-0.552-0.448-1-1-1h-2c-0.552 0-1 0.448-1 1s0.448 1 1 1h2c0.552 0 1-0.448 1-1zM28 15h-2c-0.552 0-1 0.448-1 1s0.448 1 1 1h2c0.552 0 1-0.448 1-1s-0.448-1-1-1zM8.221 9.635c0.391 0.391 1.024 0.391 1.414 0s0.391-1.023 0-1.414l-1.414-1.414c-0.391-0.391-1.023-0.391-1.414 0s-0.391 1.023 0 1.414l1.414 1.414zM23.779 22.363c-0.392-0.391-1.023-0.391-1.414 0s-0.392 1.023 0 1.414l1.414 1.414c0.391 0.391 1.023 0.391 1.414 0s0.391-1.023 0-1.414l-1.414-1.414z"></path></svg></button></div></div></header><div class="pt-14 flex max-w-screen overflow-y-scroll"><nav class="hidden lg:block fixed top-14 lg:bottom-0 lg:h-screen w-[18rem] pb-10 px-4 overflow-y-auto min-h-screen z-10"><nav><ul class="mt-6"><!--$--><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold hover:bg-hover text-lg"><a class="block" href="/html">html</a></div><ul><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/html/SemanticsTag">语义化标签</a></li><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/html/anchor">锚元素</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold hover:bg-hover text-lg"><a class="block" href="/css">css</a></div><ul><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/css/flex">flex 布局</a></li><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/css/grid">grid 布局</a></li><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/css/unit">布局单位</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold hover:bg-hover text-lg"><a class="block" href="/react">react</a></div><ul><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/react/lifecycle">lifecycle</a></li><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/react/hook">hook</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold hover:bg-hover text-lg"><a class="block" href="/react-src">react 源码</a></div><ul><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/react-src/fiber">fiber</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold hover:bg-hover text-lg"><a class="block" href="/demo">代码实例</a></div><ul><li class="pl-2 border border-transparent rounded-sm font-bold hover:bg-hover text-sm py-0.5"><a class="block" href="/demo/music-player">音乐播放器</a></li></ul></li><!--/$--></ul></nav></nav><main class="relative lg:ml-[18rem] min-w-0 flex-1 px-5 "><article class="mx-auto xl:max-w-none overflow-x-hidden xl:ml-0 xl:mr-[18rem]"><h1 class="mdx-heading text-3xl font-extrabold my-6 text-header dark:text-header-dark" id="架构">架构</h1>
<p class="whitespace-pre-wrap my-2 ">React 架构核心有三个部分：Scheduler，Reconciler，Renderer。</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed ">Reconciler (协调器)：构建 Fiber 树，比对 Fiber 对象找出差异, 记录 Fiber 对象要进行的 DOM 操作</li>
<li class="leading-relaxed ">Renderer (渲染器)：负责将发生变化的部分渲染到页面上</li>
<li class="leading-relaxed ">Scheduler (调度器)：调度任务的优先级，高优先级任务优先执行</li>
</ul>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="reconciler">Reconciler<a href="#reconciler" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">负责处理组件的协调（Reconciliation）过程，将虚拟 DOM 的更新映射到实际的 DOM 操作。</p>
<p class="whitespace-pre-wrap my-2 ">在 React 15 的版本中，采用了循环加递归的方式进行了 virtualDOM 的比对，由于递归使用 JavaScript 自身的执行栈，一旦开始就无法停止，直到任务执行完成。如果 VirtualDOM 树的层级比较深，virtualDOM 的比对就会长期占用 JavaScript 主线程，由于 JavaScript 又是单线程的无法同时执行其他任务，所以在比对的过程中无法响应用户操作，无法即时执行元素动画，造成了页面卡顿的现象。</p>
<p class="whitespace-pre-wrap my-2 ">自 React 16 的版本后，react 放弃了 JavaScript 递归的方式进行 virtualDOM 的比对，而是采用循环模拟递归。通过 fiber 架构方案，Reconciler 和 Renderer 不再交替执行。Reconciler 负责找出差异，在所有差异找出之后，统一交给 Renderer 进行 DOM 的更新。也就是 Reconciler 的主要任务就是找出差异部分，并为差异打上标记。而且比对的过程是利用浏览器的空闲时间完成的 （对比过程通过 Scheduler 来调度执行），不会长期占用主线程，这就解决了 virtualDOM 比对造成页面卡顿的问题。</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="renderer">Renderer<a href="#renderer" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">Renderer 根据 Reconciler 为 Fiber 节点打的标记，执行对应的 DOM 操作。</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="scheduler">Scheduler<a href="#scheduler" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">负责协调任务的优先级和执行顺序，决定何时执行任务以及如何分配优先级，确保页面渲染的流畅性。</p></article><aside class="hidden xl:block fixed top-14 right-0 w-[18rem] py-6 overflow-y-auto"><ul class="text-sm font-medium"><li class="pl-2 text-base">架构</li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#reconciler" class="block py-1">Reconciler</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#renderer" class="block py-1">Renderer</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#scheduler" class="block py-1">Scheduler</a></li></ul></aside></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"toc":[{"text":"架构","hash":"#架构","depth":1},{"text":"Reconciler","hash":"#reconciler","depth":2},{"text":"Renderer","hash":"#renderer","depth":2},{"text":"Scheduler","hash":"#scheduler","depth":2}],"code":"var Component=(()=\u003e{var s=Object.create;var l=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var D=(r,e)=\u003e()=\u003e(e||r((e={exports:{}}).exports,e),e.exports),O=(r,e)=\u003e{for(var c in e)l(r,c,{get:e[c],enumerable:!0})},h=(r,e,c,t)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let i of R(e))!M.call(r,i)\u0026\u0026i!==c\u0026\u0026l(r,i,{get:()=\u003ee[i],enumerable:!(t=u(e,i))||t.enumerable});return r};var m=(r,e,c)=\u003e(c=r!=null?s(p(r)):{},h(e||!r||!r.__esModule?l(c,\"default\",{value:r,enumerable:!0}):c,r)),v=r=\u003eh(l({},\"__esModule\",{value:!0}),r);var d=D((_,a)=\u003e{a.exports=_jsx_runtime});var b={};O(b,{default:()=\u003eS});var n=m(d());function o(r){let e=Object.assign({h1:\"h1\",p:\"p\",ul:\"ul\",li:\"li\",h2:\"h2\"},r.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{hash:\"\\u67B6\\u6784\",children:\"\\u67B6\\u6784\"}),`\n`,(0,n.jsx)(e.p,{children:\"React \\u67B6\\u6784\\u6838\\u5FC3\\u6709\\u4E09\\u4E2A\\u90E8\\u5206\\uFF1AScheduler\\uFF0CReconciler\\uFF0CRenderer\\u3002\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Reconciler (\\u534F\\u8C03\\u5668)\\uFF1A\\u6784\\u5EFA Fiber \\u6811\\uFF0C\\u6BD4\\u5BF9 Fiber \\u5BF9\\u8C61\\u627E\\u51FA\\u5DEE\\u5F02, \\u8BB0\\u5F55 Fiber \\u5BF9\\u8C61\\u8981\\u8FDB\\u884C\\u7684 DOM \\u64CD\\u4F5C\"}),`\n`,(0,n.jsx)(e.li,{children:\"Renderer (\\u6E32\\u67D3\\u5668)\\uFF1A\\u8D1F\\u8D23\\u5C06\\u53D1\\u751F\\u53D8\\u5316\\u7684\\u90E8\\u5206\\u6E32\\u67D3\\u5230\\u9875\\u9762\\u4E0A\"}),`\n`,(0,n.jsx)(e.li,{children:\"Scheduler (\\u8C03\\u5EA6\\u5668)\\uFF1A\\u8C03\\u5EA6\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\uFF0C\\u9AD8\\u4F18\\u5148\\u7EA7\\u4EFB\\u52A1\\u4F18\\u5148\\u6267\\u884C\"}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{hash:\"reconciler\",children:\"Reconciler\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8D1F\\u8D23\\u5904\\u7406\\u7EC4\\u4EF6\\u7684\\u534F\\u8C03\\uFF08Reconciliation\\uFF09\\u8FC7\\u7A0B\\uFF0C\\u5C06\\u865A\\u62DF DOM \\u7684\\u66F4\\u65B0\\u6620\\u5C04\\u5230\\u5B9E\\u9645\\u7684 DOM \\u64CD\\u4F5C\\u3002\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5728 React 15 \\u7684\\u7248\\u672C\\u4E2D\\uFF0C\\u91C7\\u7528\\u4E86\\u5FAA\\u73AF\\u52A0\\u9012\\u5F52\\u7684\\u65B9\\u5F0F\\u8FDB\\u884C\\u4E86 virtualDOM \\u7684\\u6BD4\\u5BF9\\uFF0C\\u7531\\u4E8E\\u9012\\u5F52\\u4F7F\\u7528 JavaScript \\u81EA\\u8EAB\\u7684\\u6267\\u884C\\u6808\\uFF0C\\u4E00\\u65E6\\u5F00\\u59CB\\u5C31\\u65E0\\u6CD5\\u505C\\u6B62\\uFF0C\\u76F4\\u5230\\u4EFB\\u52A1\\u6267\\u884C\\u5B8C\\u6210\\u3002\\u5982\\u679C VirtualDOM \\u6811\\u7684\\u5C42\\u7EA7\\u6BD4\\u8F83\\u6DF1\\uFF0CvirtualDOM \\u7684\\u6BD4\\u5BF9\\u5C31\\u4F1A\\u957F\\u671F\\u5360\\u7528 JavaScript \\u4E3B\\u7EBF\\u7A0B\\uFF0C\\u7531\\u4E8E JavaScript \\u53C8\\u662F\\u5355\\u7EBF\\u7A0B\\u7684\\u65E0\\u6CD5\\u540C\\u65F6\\u6267\\u884C\\u5176\\u4ED6\\u4EFB\\u52A1\\uFF0C\\u6240\\u4EE5\\u5728\\u6BD4\\u5BF9\\u7684\\u8FC7\\u7A0B\\u4E2D\\u65E0\\u6CD5\\u54CD\\u5E94\\u7528\\u6237\\u64CD\\u4F5C\\uFF0C\\u65E0\\u6CD5\\u5373\\u65F6\\u6267\\u884C\\u5143\\u7D20\\u52A8\\u753B\\uFF0C\\u9020\\u6210\\u4E86\\u9875\\u9762\\u5361\\u987F\\u7684\\u73B0\\u8C61\\u3002\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u81EA React 16 \\u7684\\u7248\\u672C\\u540E\\uFF0Creact \\u653E\\u5F03\\u4E86 JavaScript \\u9012\\u5F52\\u7684\\u65B9\\u5F0F\\u8FDB\\u884C virtualDOM \\u7684\\u6BD4\\u5BF9\\uFF0C\\u800C\\u662F\\u91C7\\u7528\\u5FAA\\u73AF\\u6A21\\u62DF\\u9012\\u5F52\\u3002\\u901A\\u8FC7 fiber \\u67B6\\u6784\\u65B9\\u6848\\uFF0CReconciler \\u548C Renderer \\u4E0D\\u518D\\u4EA4\\u66FF\\u6267\\u884C\\u3002Reconciler \\u8D1F\\u8D23\\u627E\\u51FA\\u5DEE\\u5F02\\uFF0C\\u5728\\u6240\\u6709\\u5DEE\\u5F02\\u627E\\u51FA\\u4E4B\\u540E\\uFF0C\\u7EDF\\u4E00\\u4EA4\\u7ED9 Renderer \\u8FDB\\u884C DOM \\u7684\\u66F4\\u65B0\\u3002\\u4E5F\\u5C31\\u662F Reconciler \\u7684\\u4E3B\\u8981\\u4EFB\\u52A1\\u5C31\\u662F\\u627E\\u51FA\\u5DEE\\u5F02\\u90E8\\u5206\\uFF0C\\u5E76\\u4E3A\\u5DEE\\u5F02\\u6253\\u4E0A\\u6807\\u8BB0\\u3002\\u800C\\u4E14\\u6BD4\\u5BF9\\u7684\\u8FC7\\u7A0B\\u662F\\u5229\\u7528\\u6D4F\\u89C8\\u5668\\u7684\\u7A7A\\u95F2\\u65F6\\u95F4\\u5B8C\\u6210\\u7684 \\uFF08\\u5BF9\\u6BD4\\u8FC7\\u7A0B\\u901A\\u8FC7 Scheduler \\u6765\\u8C03\\u5EA6\\u6267\\u884C\\uFF09\\uFF0C\\u4E0D\\u4F1A\\u957F\\u671F\\u5360\\u7528\\u4E3B\\u7EBF\\u7A0B\\uFF0C\\u8FD9\\u5C31\\u89E3\\u51B3\\u4E86 virtualDOM \\u6BD4\\u5BF9\\u9020\\u6210\\u9875\\u9762\\u5361\\u987F\\u7684\\u95EE\\u9898\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"renderer\",children:\"Renderer\"}),`\n`,(0,n.jsx)(e.p,{children:\"Renderer \\u6839\\u636E Reconciler \\u4E3A Fiber \\u8282\\u70B9\\u6253\\u7684\\u6807\\u8BB0\\uFF0C\\u6267\\u884C\\u5BF9\\u5E94\\u7684 DOM \\u64CD\\u4F5C\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"scheduler\",children:\"Scheduler\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8D1F\\u8D23\\u534F\\u8C03\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\u548C\\u6267\\u884C\\u987A\\u5E8F\\uFF0C\\u51B3\\u5B9A\\u4F55\\u65F6\\u6267\\u884C\\u4EFB\\u52A1\\u4EE5\\u53CA\\u5982\\u4F55\\u5206\\u914D\\u4F18\\u5148\\u7EA7\\uFF0C\\u786E\\u4FDD\\u9875\\u9762\\u6E32\\u67D3\\u7684\\u6D41\\u7545\\u6027\\u3002\"})]})}function x(r={}){let{wrapper:e}=r.components||{};return e?(0,n.jsx)(e,Object.assign({},r,{children:(0,n.jsx)(o,r)})):o(r)}var S=x;return v(b);})();\n;return Component;"},"__N_SSG":true},"page":"/[[...id]]","query":{"id":["react-src","architecture"]},"buildId":"1n3RON42eWQmN0ceCWFd0","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>