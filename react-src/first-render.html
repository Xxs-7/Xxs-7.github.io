<!DOCTYPE html><html lang="cn"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/28746ebb45a12272.css" as="style"/><link rel="stylesheet" href="/_next/static/css/28746ebb45a12272.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-6698976aa0ea586d.js" defer=""></script><script src="/_next/static/chunks/main-9ca4f46f71f15dad.js" defer=""></script><script src="/_next/static/chunks/pages/_app-05e36c2a7cc44a7e.js" defer=""></script><script src="/_next/static/chunks/7a7c95a0-ab903f899792323b.js" defer=""></script><script src="/_next/static/chunks/581-340f217658a3c725.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...id%5D%5D-706fc642a67ce3cd.js" defer=""></script><script src="/_next/static/td-76pZFZwbyBb6fsZog8/_buildManifest.js" defer=""></script><script src="/_next/static/td-76pZFZwbyBb6fsZog8/_ssgManifest.js" defer=""></script></head><body class=" bg-light text-light-text dark:bg-dark dark:text-dark-text max-sm:text-sm"><script>
                (function () {
                  function setTheme(newTheme) {
                    window.__theme = newTheme;
                    if (newTheme === 'dark') {
                      document.documentElement.classList.add('dark');
                    } else if (newTheme === 'light') {
                      document.documentElement.classList.remove('dark');
                    }
                  }

                  var preferredTheme;
                  try {
                    preferredTheme = localStorage.getItem('theme');
                  } catch (err) { }

                  window.__setPreferredTheme = function(newTheme) {
                    preferredTheme = newTheme;
                    setTheme(newTheme);
                    try {
                      localStorage.setItem('theme', newTheme);
                    } catch (err) { }
                  };

                  var initialTheme = preferredTheme;
                  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                  if (!initialTheme) {
                    initialTheme = darkQuery.matches ? 'dark' : 'light';
                  }
                  setTheme(initialTheme);

                  darkQuery.addEventListener('change', function (e) {
                    if (!preferredTheme) {
                      setTheme(e.matches ? 'dark' : 'light');
                    }
                  });
                })();
              </script><div id="__next"><header class="w-full fixed t-0 h-14 border-b backdrop-blur border-slate-900/10 dark:border-slate-300/10 z-10"><div class="w-full h-full flex flex-row items-center justify-between px-4"><div>厘清逻辑</div><div class="mr-2 flex flex-row items-center justify-between gap-2 text-xl"><a href="https://github.com/Xxs-7/Xxs-7.github.io" class="p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><button class="block dark:hidden p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5" type="button" aria-label="Use Dark Mode"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"></path></svg></button><button type="button" class="hidden dark:block p-1 rounded-full hover:bg-dark/5 hover:dark:bg-light/5" aria-label="Use Light Mode"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79zM1 10.5h3v2H1zM11 .55h2V3.5h-2zm8.04 2.495l1.408 1.407-1.79 1.79-1.407-1.408zm-1.8 15.115l1.79 1.8 1.41-1.41-1.8-1.79zM20 10.5h3v2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm-1 4h2v2.95h-2zm-7.45-.96l1.41 1.41 1.79-1.8-1.41-1.41z"></path></svg></button></div></div></header><div class="pt-14 flex max-w-screen overflow-y-scroll"><nav class="hidden lg:block fixed top-14 lg:bottom-0 lg:h-screen w-[18rem] pb-10 px-4 overflow-y-auto min-h-screen z-10"><nav><ul class="mt-6"><!--$--><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">html</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/html/SemanticsTag">语义化标签</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/html/anchor">锚元素</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">css</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/flex">flex 布局</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/grid">grid 布局</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/css/unit">布局单位</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">javascript</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/javascript/promise">promise</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">react</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/lifecycle">lifecycle</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/hook">hook</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react/high-compoment">组件逻辑复用方案</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">react 源码</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/architecture">源码架构</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/fiber-node">fiber 节点</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/render-mode">渲染模式</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/scheduler">scheduler</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5 text-highlight"><a class="block" href="/react-src/first-render">初次渲染</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/update-render">更新渲染</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/render-task">渲染任务的执行</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/react-src/execution-context">执行上下文</a></li></ul></li><li class="mt-1"><div class="pl-1 border border-transparent rounded-sm font-bold text-lg">实践</div><ul><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/demo/music-player">音乐播放器</a></li><li class="pl-4 border border-transparent rounded-sm font-bold hover:bg-dark/5 text-sm py-0.5 hover:dark:bg-light/5"><a class="block" href="/demo/font-advance">字体库优化</a></li></ul></li><!--/$--></ul></nav></nav><main class="relative lg:ml-[18rem] min-w-0 flex-1 px-5 "><article class="mx-auto xl:max-w-none overflow-x-hidden xl:ml-0 xl:mr-[18rem]"><h1 class="mdx-heading text-3xl font-extrabold my-6 text-header dark:text-header-dark" id="初次渲染的发起">初次渲染的发起</h1>
<p class="whitespace-pre-wrap my-2 ">初次渲染做的事：将入口函数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 的组件树渲染到页面中。</p>
<p class="whitespace-pre-wrap my-2 ">初次渲染在 react 源码的执行逻辑中，我认为是可以分成两个部分：</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed ">渲染任务的创建，也就是 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 这个函数的执行结果，将渲染任务放置到 scheduler 的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">taskQueue</code> 中；</li>
<li class="leading-relaxed ">渲染任务的执行，也就是常说的 render 和 commit 阶段，在 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">taskQueue</code> 中拿出渲染任务，并在宏任务中的以浏览器事件循环的方式执行。</li>
</ul>
<p class="whitespace-pre-wrap my-2 ">这，不就是多生产者单消费者的设计模式吗？</p>
<p class="whitespace-pre-wrap my-2 ">本文主要讲 react 应用从开始到 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 结束的过程。</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="剖析源码">剖析源码<a href="#剖析源码" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">初次渲染主要做的事情是初始化一些数据结构并创建渲染任务，移交给 scheduler 执行。</p>
<pre><!--$--><div class="prism-code language-tsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> root </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">document</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">getElementById</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">&quot;root&quot;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">render</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">MyPage</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">/&gt;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 是 react 进入主体函数的入口之一，内部采用的是 concurrent 模式。<strong class="font-bold"><strong class="font-bold"><a href="https://zh-hans.react.dev/blog/2022/03/29/react-v18#what-is-concurrent-react" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">什么是并发 React？</a></strong></strong></p>
<p class="whitespace-pre-wrap my-2 ">17 以前常用的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">render</code>  仍可以使用，为 legacy 模式，相较于 concurrent 模式少了 react 18 中 transition 等新特性。<strong class="font-bold"><a href="https://17.reactjs.org/docs/concurrent-mode-adoption.html#feature-comparison" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">Feature Comparison</a></strong></p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="createroot"><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code><a href="#createroot" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// react/packages/react-dom/src/client/ReactDOM.js</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  createRoot </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="whitespace-pre-wrap"> createRootImpl</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">&#x27;./ReactDOMRoot&#x27;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">container</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Element</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Document</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">DocumentFragment</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  options</span><span class="whitespace-pre-wrap">?</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">CreateRootOptions</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootType</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createRootImpl</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> options</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 "><strong class="font-bold">参数</strong></p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">container</code>：可以是 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">Element | Document | DocumentFragment</code>，此处为<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">div#root</code> ，即<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">element</code> ，关于这几个原生标签类型可以查看 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element" class="hover:underline text-highlight decoration-2 underline-offset-2 decoration-highlight">Element</a>  了解。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">options？</code> ：可选，配置选项，此处值 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">null</code>，略。</p>
<h3 class="mdx-heading text-xl font-semibold whitespace-pre-wrap mt-4 mb-2 group text-header dark:text-header-dark" id="createrootimpl"><strong class="font-bold"><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRootImpl</code></strong><a href="#createrootimpl" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h3>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRootImpl</code> 中<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">impl</code>是<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">implement</code> 的缩写，实际是 ReactDOMRoot.js 的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code>，观察代码可以发现，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 返回的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 变量就是这里的值<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">new ReactDOMRoot(root)</code></p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// react/packages/react-dom/src/client/ReactDOMRoot.js</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">container</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Element</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Document</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">DocumentFragment</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  options</span><span class="whitespace-pre-wrap">?</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">CreateRootOptions</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootType</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> isStrictMode </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">false</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> concurrentUpdatesByDefaultOverride </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">false</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> identifierPrefix </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> onRecoverableError </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> defaultOnRecoverableError</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> transitionCallbacks </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 根据传入的根元素，创建 container 实例 root</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> root </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createContainer</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">ConcurrentRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    isStrictMode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    identifierPrefix</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    onRecoverableError</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    transitionCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">markContainerAsRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 返回一个新建的 ReactDOMRoot 实例</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ReactDOMRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">其中， <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createContainer</code> 被调用，创建 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">FiberRoot</code> **:</p>
<pre><!--$--><div class="prism-code language-js rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// react/packages/react-reconciler/src/ReactFiberReconciler.old.js</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createContainer</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">containerInfo</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootTag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">hydrationCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">SuspenseHydrationCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">isStrictMode</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">identifierPrefix</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> string</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">onRecoverableError</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">error</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> mixed</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=&gt;</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">transitionCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">TransitionTracingCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">OpaqueRoot</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> hydrate </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">false</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> initialChildren </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createFiberRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    containerInfo</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    tag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    hydrate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    initialChildren</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    hydrationCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    isStrictMode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    identifierPrefix</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    onRecoverableError</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    transitionCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">通过打 log 可以得到，其参数实际值如下：</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">containerInfo</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> div#root</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">1</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// ConcurrentRoot</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">hydrationCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">isStrictMode</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">false</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">identifierPrefix</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">onRecoverableError</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">error</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> mixed</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=&gt;</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap">transitionCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">所以， <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createContainer</code> 返回的是一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> ，即 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 的作用是容器，存放当前应用一些全局的信息。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createFiberRoot</code></p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createFiberRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">containerInfo</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootTag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">hydrate</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">initialChildren</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ReactNodeList</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">hydrationCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">SuspenseHydrationCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">isStrictMode</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// TODO: We have several of these arguments that are conceptually part of the</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// host config, but because they are passed in at runtime, we have to thread</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// them through the root constructor. Perhaps we should put them all into a</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// single type, like a DynamicHostConfig that is defined by the renderer.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">identifierPrefix</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> string</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">onRecoverableError</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">error</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> mixed</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=&gt;</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">transitionCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">TransitionTracingCallbacks</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">FiberRoot</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">FiberRoot</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">FiberRootNode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    containerInfo</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    tag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    hydrate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    identifierPrefix</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    onRecoverableError</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> any</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// Cyclic construction. This cheats the type system right now because</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// stateNode is any.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> uninitializedFiber </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createHostRootFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    tag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    isStrictMode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">stateNode</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">enableCache</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">		</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 首次渲染并无 cache</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">initialState</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootState</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">element</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> initialChildren</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">isDehydrated</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> hydrate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">cache</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> any</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// not enabled yet</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">memoizedState</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> initialState</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">initializeUpdateQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">这个函数简化流程就是新建了一个<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">FiberRootNode</code> 实例，名为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> ，并将其作为返回值。</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">FiberRootNode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">containerInfo</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  tag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  hydrate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  identifierPrefix</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  onRecoverableError</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> tag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">containerInfo</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> containerInfo</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">pendingChildren</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">在创建了 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 对象，还通过<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createHostRootFiber</code> 创建了名为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 的实例：</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createHostRootFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">RootTag</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">isStrictMode</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">concurrentUpdatesByDefaultOverride</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">|</span><span class="whitespace-pre-wrap"> boolean</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Fiber</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="whitespace-pre-wrap"> mode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">tag </span><span class="whitespace-pre-wrap">===</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ConcurrentRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">		</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 设置了 ConcurrentMode，启用新特性</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    mode </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ConcurrentMode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	  </span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    mode </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">NoMode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">HostRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> mode</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">然后 ，对 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 做了以下双向链接：</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"> root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"> uninitializedFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">stateNode</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">然后，做了<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">state</code> 的初始化工作。新建 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">RootState</code> 对象，赋值给 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFibe.memoizedState</code> 上，调用 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">initializeUpdateQueue</code> ，其中新建了一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">UpdateQueue&lt;State&gt;</code> 对象，赋值给<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFibe.updateQueue</code> 。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">markContainerAsRoot</code>实际上就是把上面的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 赋值给 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">div#root</code> 的<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">internalContainerInstanceKey</code> 属性。方便通过元素获取对应的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiber</code>。</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">ReactDOMRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">internalRoot</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">FiberRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">_internalRoot</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> internalRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">实际上是生成一个<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">ReactDomRoot</code> 实例，把通过 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createContainer</code> 生成的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 赋值给他的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">_internalRoot</code> 属性，至此，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 结束。</p>
<h3 class="mdx-heading text-xl font-semibold whitespace-pre-wrap mt-4 mb-2 group text-header dark:text-header-dark" id="结论">结论<a href="#结论" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h3>
<p class="whitespace-pre-wrap my-2 ">所以 createRoot 的结果是：</p>
<ol class="ml-6 my-3 list-decimal">
<li class="leading-relaxed ">通过 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRootImp</code> 函数，创建了一个名为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">FiberRootNode</code> 实例，是 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">div#root</code> 对应的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiber</code>；</li>
<li class="leading-relaxed ">创建了一个名为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 的  <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">FiberNode</code> 实例，并且将<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 的  <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">current</code> 指向 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code>，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">stateNode</code> 指向 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code>;</li>
<li class="leading-relaxed ">修改 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">div#root</code> 的属性<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">internalContainerInstanceKey</code> 指向 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code>；</li>
<li class="leading-relaxed ">最后返回一个<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">ReactDomRoot</code> 实例，它的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">_internalRoot</code> 指向 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root。</code></li>
</ol>
<h3 class="mdx-heading text-xl font-semibold whitespace-pre-wrap mt-4 mb-2 group text-header dark:text-header-dark" id="难点">难点<a href="#难点" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h3>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code></p>
<p class="whitespace-pre-wrap my-2 ">对于上面的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">root</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">uninitializedFiber</code> 可以简化称为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code></p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 表示整个 React 应用的根组件，它是 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">ReactFiberRoot</code> 类型的对象；</li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> 表示组件树的根节点，它是 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">ReactFiber</code> 类型的对象。</li>
</ul>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 负责管理整个应用的组件树，它维护一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">current</code> 属性（指向<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> ） ，表示组件树的根节点。当创建一个组件时，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 会创建一个新的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code>，并将它赋值给组件的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">_reactInternalFiber</code> 属性。当组件被销毁时，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 会释放对应的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code>。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> 负责管理组件树的一个节点。它维护一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">children</code> 数组，表示该节点的子节点；当添加或删除子节点时，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> 会自动更新其 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">children</code> 数组。</p>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="render"><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">render</code><a href="#render" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">具体把 react 组件渲染到页面</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ReactDOMRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">prototype</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">render</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">children</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ReactNodeList</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> root </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">_internalRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">		</span><span class="whitespace-pre-wrap">...</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">updateContainer</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">children</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">通过 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">this._internalRoot</code> 拿到上面 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> ，进入核心函数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateConatiner</code></p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// react/packages/react-reconciler/src/ReactFiberReconciler.old.js</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">updateContainer</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">element</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">ReactNodeList</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">container</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">OpaqueRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">parentComponent</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">?</span><span class="whitespace-pre-wrap">React$Component</span><span class="whitespace-pre-wrap">&lt;</span><span class="whitespace-pre-wrap">any</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> any</span><span class="whitespace-pre-wrap">&gt;</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap">callback</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">?</span><span class="whitespace-pre-wrap">Function</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Lane</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  ···</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 1. 拿到 rootFiber, 当前更新的时间戳 eventTime，</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 以及更新的优先级 lane，当前更新的上下文 context</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> current </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> eventTime </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">requestEventTime</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> lane </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">requestUpdateLane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">	</span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// enableSchedulingProfiler 为内部收集性能数据的启动开关，可以不必理会</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">enableSchedulingProfiler</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">markRenderScheduled</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> context </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">getContextForSubtree</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">parentComponent</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">context</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">===</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">context</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> context</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    container</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">pendingContext</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> context</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  ···</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 2. 创建更新任务</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> update </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createUpdate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">eventTime</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// Caution: React DevTools currently depends on this property</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// being called &quot;element&quot;.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">payload</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap">element</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  callback </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> callback </span><span class="whitespace-pre-wrap">===</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">undefined</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">?</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> callback</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">callback </span><span class="whitespace-pre-wrap">!==</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    ···</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">callback</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> callback</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 3. update 入队，返回 update 的 fiberRoot</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> root </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">enqueueUpdate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">root </span><span class="whitespace-pre-wrap">!==</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 4. 告诉 scheduler 要对 fiber 进行处理</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">scheduleUpdateOnFiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> eventTime</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// 5. 处理非紧急更新 transition</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">entangleTransitions</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">root</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> current</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 ">参数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">element</code> ：为将被渲染的组件树，例如 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">&lt;MyPage/&gt;</code>；</p>
<p class="whitespace-pre-wrap my-2 ">参数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">container</code> ： 为前一步<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code>创建的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code>；</p>
<p class="whitespace-pre-wrap my-2 ">变量 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">current</code> ：为前一步<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code>创建的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code>；</p>
<p class="whitespace-pre-wrap my-2 ">函数<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">requestUpdateLane</code> ：根据当前的更新类型获得其 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">lane</code> 值（优先级）；</p>
<p class="whitespace-pre-wrap my-2 ">函数<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">getContextForSubtree</code>：获取组件树中一个组件的上下文对象<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">context</code> ， 这不是所谓的状态管理方案的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">context</code>;</p>
<p class="whitespace-pre-wrap my-2 ">函数 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createUpdate</code> ：创建了一个 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">update</code> 对象，将组件树作为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">payload</code>；<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">callback</code> 为渲染后要执行的回调函数；</p>
<p class="whitespace-pre-wrap my-2 ">函数<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">enqueueUpdate</code> ：将 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">update</code> 存入更新队列，这里是存在变量 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">concurrentQueues</code> 中，该变量用于存放当前正在处理的渲染任务。</p>
<p class="whitespace-pre-wrap my-2 ">核心函数<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">scheduleUpdateOnFiber</code>  ：用于调度处理组件的更新。也就是调用 scheduler 的 api，将渲染任务封装成 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">task</code> 等待被执行。</p>
<p class="whitespace-pre-wrap my-2 ">函数<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">entangleTransitions</code> ：处理 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">transition</code> 的更新。</p>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">update</code> 对象，从初次渲染可以看出，组件树（<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">elment</code>）被作为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">payload</code> 放置到实例中。</p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">createUpdate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">eventTime</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> number</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">lane</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">mixed</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">update</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">Update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">mixed</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap"> = </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    eventTime</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">tag</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">UpdateState</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">payload</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">callback</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">next</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap">;</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  return update;</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">}</span></div></div><!--/$--></pre>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// createRoot 中 updateQueue 的初始化</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap"></span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> initializeUpdateQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">State</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap">(fiber: Fiber): void </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">queue</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">UpdateQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">State</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap"> = </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">baseState</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> fiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">memoizedState</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">firstBaseUpdate</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">lastBaseUpdate</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">shared</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">pending</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">lanes</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">NoLanes</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap">hiddenCallbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap">callbacks</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap">;</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  fiber.updateQueue = queue;</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">}</span></div></div><!--/$--></pre>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> 加入 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code></p>
<pre><!--$--><div class="prism-code language-jsx rounded-md p-4 overflow-x-auto text-sm" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="whitespace-pre-wrap"> enqueueUpdate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">State</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap">(</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  fiber: Fiber,</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  update: Update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">State</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap">,</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  lane: Lane,</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">): FiberRoot | null </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> updateQueue </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> fiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">updateQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">updateQueue </span><span class="whitespace-pre-wrap">===</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// Only occurs if the fiber has been unmounted.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">sharedQueue</span><span class="whitespace-pre-wrap">:</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">SharedQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&lt;</span><span class="whitespace-pre-wrap" style="color:rgb(255, 121, 198)">State</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">&gt;</span><span class="whitespace-pre-wrap"> = (updateQueue: any).shared;</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  if (isUnsafeClassRenderPhaseUpdate(fiber)) </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// This is an unsafe render phase update. Add directly to the update</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// queue so we can process it immediately during the current render.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="whitespace-pre-wrap"> pending </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> sharedQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">pending</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">pending </span><span class="whitespace-pre-wrap">===</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// This is the first update. Create a circular list.</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">next</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">next</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> pending</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">next</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">      pending</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">next</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    sharedQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">.</span><span class="whitespace-pre-wrap">pending</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap">=</span><span class="whitespace-pre-wrap"> update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// Update the childLanes even though we&#x27;re most likely already rendering</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// this fiber. This is for backwards compatibility in the case where you</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// update a different component during render phase than the one that is</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(98, 114, 164)">// currently renderings (a pattern that is accompanied by a warning).</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">unsafe_markUpdateLaneFromFiberToRoot</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">fiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"> else </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">{</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">    </span><span class="whitespace-pre-wrap" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="whitespace-pre-wrap"> </span><span class="whitespace-pre-wrap" style="color:rgb(80, 250, 123)">enqueueConcurrentClassUpdate</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">(</span><span class="whitespace-pre-wrap">fiber</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> sharedQueue</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> update</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">,</span><span class="whitespace-pre-wrap"> lane</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">)</span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">;</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">  </span><span class="whitespace-pre-wrap" style="color:rgb(248, 248, 242)">}</span><span class="whitespace-pre-wrap"></span></div><div class="token-line" style="color:#F8F8F2"><span class="whitespace-pre-wrap">}</span></div></div><!--/$--></pre>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="总结">总结<a href="#总结" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">createRoot</code> 中，创建了 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">fiberRoot</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">rootFiber</code> ，并初始化了 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code></li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">render</code>  中，创建了 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">update</code> ，并将组件树作为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">payload</code> ，调用 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">scheduleUpdateOnFiber</code></li>
</ul>
<h2 class="mdx-heading text-2xl font-bold whitespace-pre-wrap mt-6 mb-4 group text-header  dark:text-header-dark" id="一些补充">一些补充<a href="#一些补充" class="hidden pl-2 group-hover:inline-block"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></a></h2>
<p class="whitespace-pre-wrap my-2 ">补充一些不是特别重要的内容。</p>
<p class="whitespace-pre-wrap my-2 ">执行上下文，这里是 react 内部概念下，并非函数概念下的执行上下文。</p>
<ul class="ml-6 my-3 list-disc">
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">NoContext</code> 表示没有上下文；</li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">BatchedContext</code> 表示批量更新上下文，同时有多个 setState，此时为批量更新；</li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">RenderContext</code> 表示渲染上下文，通常 react 渲染分为 render 和 commit 阶段；</li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">CommitContext</code> 表示提交上下文。
这些变量用于表示组件渲染过程中的状态，以便于更好地管理和优化。</li>
</ul>
<p class="whitespace-pre-wrap my-2 "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code>  中还有 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">shared</code> 属性，被称为 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">shareQueue</code> 。
<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">sharedQueue</code>简单讲 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code> 存放异步任务，<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">sharedQueue</code> 存放同步任务。
组件渲染过程中，会执行一些组件内部的函数（例如<code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">useEffect</code> 或 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">useCallback</code>）。它们通常会执行一些产生 sideEffect 的代码，如设置 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">timer</code>，修改 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">DOM</code>、调整 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">state</code> 等。React 通过将 sideEffect 存储在 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code> 和 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">sharedQueue</code> ，并在适当的时机执行它们来提高性能。</p>
<ol class="ml-6 my-3 list-decimal">
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code>：这个队列用于存储需要在下一个事件循环中执行的更新操作（这里是 react 中异步任务的概念，即产生更新操作在下次事件循环执行），例如组件的 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">state</code> 发生变化时，它会将更新操作添加到 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">updateQueue</code> 中。在下一个事件循环中，它们会被取出并执行，从而更新组件的 UI。</li>
<li class="leading-relaxed "><code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">sharedQueue</code>：这个队列用于存储在当前事件循环中执行的同步任务。当使用 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">useEffect</code> 或 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">useCallback</code> Hook 时，它们会在组件的渲染过程中执行一个函数，这个函数通常会执行一些产生 sideEffect 的代码。这些 sideEffect 在组件的渲染完成后才会执行，因此它们是同步的。当执行完成后，它会将更新操作添加到 <code class="inline text-code text-secondary dark:text-secondary-dark px-1.5 py-0.5 mx-0.5 rounded-md no-underline bg-[#f2ecde] dark:bg-[#2b333e] text-highlight whitespace-pre-wrap">sharedQueue</code> 中。在同一个事件循环中，它们会被取出并执行，从而更新组件的 UI。</li>
</ol>
<p class="whitespace-pre-wrap my-2 ">这样做目的是更有效地管理和组织任务，从而提高性能。</p></article><aside class="hidden xl:block fixed top-14 right-0 w-[18rem] py-6 overflow-y-auto"><ul class="text-sm font-medium"><li class="pl-2 text-base">初次渲染的发起</li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#剖析源码" class="block py-1">剖析源码</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#createroot" class="block py-1">createRoot</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-6 text-xs"><a href="#createrootimpl" class="block py-1">createRootImpl</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-6 text-xs"><a href="#结论" class="block py-1">结论</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-6 text-xs"><a href="#难点" class="block py-1">难点</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#render" class="block py-1">render</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#总结" class="block py-1">总结</a></li><li class="border-l hover:text-hover border-slate-900/10 dark:border-slate-300/10 pl-4"><a href="#一些补充" class="block py-1">一些补充</a></li></ul></aside></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"toc":[{"text":"初次渲染的发起","hash":"#初次渲染的发起","depth":1},{"text":"剖析源码","hash":"#剖析源码","depth":2},{"text":"createRoot","hash":"#createroot","depth":2},{"text":"createRootImpl","hash":"#createrootimpl","depth":3},{"text":"结论","hash":"#结论","depth":3},{"text":"难点","hash":"#难点","depth":3},{"text":"render","hash":"#render","depth":2},{"text":"总结","hash":"#总结","depth":2},{"text":"一些补充","hash":"#一些补充","depth":2}],"code":"var Component=(()=\u003e{var u=Object.create;var o=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var R=(r,e)=\u003e()=\u003e(e||r((e={exports:{}}).exports,e),e.exports),m=(r,e)=\u003e{for(var t in e)o(r,t,{get:e[t],enumerable:!0})},d=(r,e,t,i)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let c of p(e))!f.call(r,c)\u0026\u0026c!==t\u0026\u0026o(r,c,{get:()=\u003ee[c],enumerable:!(i=s(e,c))||i.enumerable});return r};var g=(r,e,t)=\u003e(t=r!=null?u(b(r)):{},d(e||!r||!r.__esModule?o(t,\"default\",{value:r,enumerable:!0}):t,r)),F=r=\u003ed(o({},\"__esModule\",{value:!0}),r);var a=R((k,l)=\u003e{l.exports=_jsx_runtime});var y={};m(y,{default:()=\u003ex});var n=g(a());function h(r){let e=Object.assign({h1:\"h1\",p:\"p\",code:\"code\",ul:\"ul\",li:\"li\",h2:\"h2\",pre:\"pre\",strong:\"strong\",a:\"a\",h3:\"h3\",ol:\"ol\"},r.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{hash:\"\\u521D\\u6B21\\u6E32\\u67D3\\u7684\\u53D1\\u8D77\",children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u7684\\u53D1\\u8D77\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u521D\\u6B21\\u6E32\\u67D3\\u505A\\u7684\\u4E8B\\uFF1A\\u5C06\\u5165\\u53E3\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7684\\u7EC4\\u4EF6\\u6811\\u6E32\\u67D3\\u5230\\u9875\\u9762\\u4E2D\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u5728 react \\u6E90\\u7801\\u7684\\u6267\\u884C\\u903B\\u8F91\\u4E2D\\uFF0C\\u6211\\u8BA4\\u4E3A\\u662F\\u53EF\\u4EE5\\u5206\\u6210\\u4E24\\u4E2A\\u90E8\\u5206\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6E32\\u67D3\\u4EFB\\u52A1\\u7684\\u521B\\u5EFA\\uFF0C\\u4E5F\\u5C31\\u662F \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u8FD9\\u4E2A\\u51FD\\u6570\\u7684\\u6267\\u884C\\u7ED3\\u679C\\uFF0C\\u5C06\\u6E32\\u67D3\\u4EFB\\u52A1\\u653E\\u7F6E\\u5230 scheduler \\u7684 \",(0,n.jsx)(e.code,{children:\"taskQueue\"}),\" \\u4E2D\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6E32\\u67D3\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\uFF0C\\u4E5F\\u5C31\\u662F\\u5E38\\u8BF4\\u7684 render \\u548C commit \\u9636\\u6BB5\\uFF0C\\u5728 \",(0,n.jsx)(e.code,{children:\"taskQueue\"}),\" \\u4E2D\\u62FF\\u51FA\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u5E76\\u5728\\u5B8F\\u4EFB\\u52A1\\u4E2D\\u7684\\u4EE5\\u6D4F\\u89C8\\u5668\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u7684\\u65B9\\u5F0F\\u6267\\u884C\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD9\\uFF0C\\u4E0D\\u5C31\\u662F\\u591A\\u751F\\u4EA7\\u8005\\u5355\\u6D88\\u8D39\\u8005\\u7684\\u8BBE\\u8BA1\\u6A21\\u5F0F\\u5417\\uFF1F\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u672C\\u6587\\u4E3B\\u8981\\u8BB2 react \\u5E94\\u7528\\u4ECE\\u5F00\\u59CB\\u5230 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7ED3\\u675F\\u7684\\u8FC7\\u7A0B\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u5256\\u6790\\u6E90\\u7801\",children:\"\\u5256\\u6790\\u6E90\\u7801\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u4E3B\\u8981\\u505A\\u7684\\u4E8B\\u60C5\\u662F\\u521D\\u59CB\\u5316\\u4E00\\u4E9B\\u6570\\u636E\\u7ED3\\u6784\\u5E76\\u521B\\u5EFA\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u79FB\\u4EA4\\u7ED9 scheduler \\u6267\\u884C\\u3002\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-tsx\",children:`const root = createRoot(document.getElementById(\"root\"));\nroot.render(\u003cMyPage /\u003e);\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u662F react \\u8FDB\\u5165\\u4E3B\\u4F53\\u51FD\\u6570\\u7684\\u5165\\u53E3\\u4E4B\\u4E00\\uFF0C\\u5185\\u90E8\\u91C7\\u7528\\u7684\\u662F concurrent \\u6A21\\u5F0F\\u3002\",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://zh-hans.react.dev/blog/2022/03/29/react-v18#what-is-concurrent-react\",children:\"\\u4EC0\\u4E48\\u662F\\u5E76\\u53D1 React\\uFF1F\"})})})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"17 \\u4EE5\\u524D\\u5E38\\u7528\\u7684 \",(0,n.jsx)(e.code,{children:\"render\"}),\"  \\u4ECD\\u53EF\\u4EE5\\u4F7F\\u7528\\uFF0C\\u4E3A legacy \\u6A21\\u5F0F\\uFF0C\\u76F8\\u8F83\\u4E8E concurrent \\u6A21\\u5F0F\\u5C11\\u4E86 react 18 \\u4E2D transition \\u7B49\\u65B0\\u7279\\u6027\\u3002\",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://17.reactjs.org/docs/concurrent-mode-adoption.html#feature-comparison\",children:\"Feature Comparison\"})})]}),`\n`,(0,n.jsx)(e.h2,{hash:\"createroot\",children:(0,n.jsx)(e.code,{children:\"createRoot\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-dom/src/client/ReactDOM.js\nimport {\n  createRoot as createRootImpl,\n\t...\n} from './ReactDOMRoot';\n\nfunction createRoot(\n  container: Element | Document | DocumentFragment,\n  options?: CreateRootOptions,\n): RootType {\n\t...\n\n  return createRootImpl(container, options);\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"\\u53C2\\u6570\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"container\"}),\"\\uFF1A\\u53EF\\u4EE5\\u662F \",(0,n.jsx)(e.code,{children:\"Element | Document | DocumentFragment\"}),\"\\uFF0C\\u6B64\\u5904\\u4E3A\",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\uFF0C\\u5373\",(0,n.jsx)(e.code,{children:\"element\"}),\" \\uFF0C\\u5173\\u4E8E\\u8FD9\\u51E0\\u4E2A\\u539F\\u751F\\u6807\\u7B7E\\u7C7B\\u578B\\u53EF\\u4EE5\\u67E5\\u770B \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element\",children:\"Element\"}),\"  \\u4E86\\u89E3\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"options\\uFF1F\"}),\" \\uFF1A\\u53EF\\u9009\\uFF0C\\u914D\\u7F6E\\u9009\\u9879\\uFF0C\\u6B64\\u5904\\u503C \",(0,n.jsx)(e.code,{children:\"null\"}),\"\\uFF0C\\u7565\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{hash:\"createrootimpl\",children:(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.code,{children:\"createRootImpl\"})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"createRootImpl\"}),\"\\xA0\\u4E2D\",(0,n.jsx)(e.code,{children:\"impl\"}),\"\\u662F\",(0,n.jsx)(e.code,{children:\"implement\"}),\" \\u7684\\u7F29\\u5199\\uFF0C\\u5B9E\\u9645\\u662F ReactDOMRoot.js \\u7684 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\uFF0C\\u89C2\\u5BDF\\u4EE3\\u7801\\u53EF\\u4EE5\\u53D1\\u73B0\\uFF0C\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u8FD4\\u56DE\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u53D8\\u91CF\\u5C31\\u662F\\u8FD9\\u91CC\\u7684\\u503C\",(0,n.jsx)(e.code,{children:\"new ReactDOMRoot(root)\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-dom/src/client/ReactDOMRoot.js\nexport function createRoot(\n  container: Element | Document | DocumentFragment,\n  options?: CreateRootOptions,\n): RootType {\n\t...\n\n  let isStrictMode = false;\n  let concurrentUpdatesByDefaultOverride = false;\n  let identifierPrefix = '';\n  let onRecoverableError = defaultOnRecoverableError;\n  let transitionCallbacks = null;\n\n  ...\n\t// \\u6839\\u636E\\u4F20\\u5165\\u7684\\u6839\\u5143\\u7D20\\uFF0C\\u521B\\u5EFA container \\u5B9E\\u4F8B root\n  const root = createContainer(\n    container,\n    ConcurrentRoot,\n    null,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n    identifierPrefix,\n    onRecoverableError,\n    transitionCallbacks,\n  );\n  markContainerAsRoot(root.current, container);\n\n  ...\n\t// \\u8FD4\\u56DE\\u4E00\\u4E2A\\u65B0\\u5EFA\\u7684 ReactDOMRoot \\u5B9E\\u4F8B\n  // $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions\n  return new ReactDOMRoot(root);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5176\\u4E2D\\uFF0C \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u88AB\\u8C03\\u7528\\uFF0C\\u521B\\u5EFA \",(0,n.jsx)(e.code,{children:\"FiberRoot\"}),\" **:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`// react/packages/react-reconciler/src/ReactFiberReconciler.old.js\nexport function createContainer(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n  identifierPrefix: string,\n  onRecoverableError: (error: mixed) =\u003e void,\n  transitionCallbacks: null | TransitionTracingCallbacks,\n): OpaqueRoot {\n  const hydrate = false;\n  const initialChildren = null;\n  return createFiberRoot(\n    containerInfo,\n    tag,\n    hydrate,\n    initialChildren,\n    hydrationCallbacks,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n    identifierPrefix,\n    onRecoverableError,\n    transitionCallbacks,\n  );\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u901A\\u8FC7\\u6253 log \\u53EF\\u4EE5\\u5F97\\u5230\\uFF0C\\u5176\\u53C2\\u6570\\u5B9E\\u9645\\u503C\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`containerInfo: div#root\ntag: 1 // ConcurrentRoot\nhydrationCallbacks: null \nisStrictMode: false,\nconcurrentUpdatesByDefaultOverride: null\nidentifierPrefix: '',\nonRecoverableError: (error: mixed) =\u003e void,\ntransitionCallbacks: null,\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6240\\u4EE5\\uFF0C \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u8FD4\\u56DE\\u7684\\u662F\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\uFF0C\\u5373 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u7684\\u4F5C\\u7528\\u662F\\u5BB9\\u5668\\uFF0C\\u5B58\\u653E\\u5F53\\u524D\\u5E94\\u7528\\u4E00\\u4E9B\\u5168\\u5C40\\u7684\\u4FE1\\u606F\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"createFiberRoot\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createFiberRoot(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrate: boolean,\n  initialChildren: ReactNodeList,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n  // TODO: We have several of these arguments that are conceptually part of the\n  // host config, but because they are passed in at runtime, we have to thread\n  // them through the root constructor. Perhaps we should put them all into a\n  // single type, like a DynamicHostConfig that is defined by the renderer.\n  identifierPrefix: string,\n  onRecoverableError: null | ((error: mixed) =\u003e void),\n  transitionCallbacks: null | TransitionTracingCallbacks,\n): FiberRoot {\n  // $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions\n  const root: FiberRoot = (new FiberRootNode(\n    containerInfo,\n    tag,\n    hydrate,\n    identifierPrefix,\n    onRecoverableError,\n  ): any);\n\n  ...\n\n  // Cyclic construction. This cheats the type system right now because\n  // stateNode is any.\n  const uninitializedFiber = createHostRootFiber(\n    tag,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n  );\n  root.current = uninitializedFiber;\n  uninitializedFiber.stateNode = root;\n  if (enableCache) {\n    ...\n  } else {\n\t\t// \\u9996\\u6B21\\u6E32\\u67D3\\u5E76\\u65E0 cache\n    const initialState: RootState = {\n      element: initialChildren,\n      isDehydrated: hydrate,\n      cache: (null: any), // not enabled yet\n    };\n    uninitializedFiber.memoizedState = initialState;\n  }\n\n  initializeUpdateQueue(uninitializedFiber);\n\n  return root;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8FD9\\u4E2A\\u51FD\\u6570\\u7B80\\u5316\\u6D41\\u7A0B\\u5C31\\u662F\\u65B0\\u5EFA\\u4E86\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"FiberRootNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\uFF0C\\u5E76\\u5C06\\u5176\\u4F5C\\u4E3A\\u8FD4\\u56DE\\u503C\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`function FiberRootNode(\n  containerInfo,\n  tag,\n  hydrate,\n  identifierPrefix,\n  onRecoverableError,\n) {\n  this.tag = tag;\n  this.containerInfo = containerInfo;\n  this.pendingChildren = null;\n\t...\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5728\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8FD8\\u901A\\u8FC7\",(0,n.jsx)(e.code,{children:\"createHostRootFiber\"}),\" \\u521B\\u5EFA\\u4E86\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684\\u5B9E\\u4F8B\\uFF1A\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createHostRootFiber(\n  tag: RootTag,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n): Fiber {\n  let mode;\n  if (tag === ConcurrentRoot) {\n\t\t// \\u8BBE\\u7F6E\\u4E86 ConcurrentMode\\uFF0C\\u542F\\u7528\\u65B0\\u7279\\u6027\n    mode = ConcurrentMode;\n\t  ...\n  } else {\n    mode = NoMode;\n  }\n\t\n\t...\n\n  return createFiber(HostRoot, null, null, mode);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E \\uFF0C\\u5BF9 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u505A\\u4E86\\u4EE5\\u4E0B\\u53CC\\u5411\\u94FE\\u63A5\\uFF1A\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:` root.current = uninitializedFiber;\n uninitializedFiber.stateNode = root;\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E\\uFF0C\\u505A\\u4E86\",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u7684\\u521D\\u59CB\\u5316\\u5DE5\\u4F5C\\u3002\\u65B0\\u5EFA \",(0,n.jsx)(e.code,{children:\"RootState\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8D4B\\u503C\\u7ED9 \",(0,n.jsx)(e.code,{children:\"uninitializedFibe.memoizedState\"}),\" \\u4E0A\\uFF0C\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"initializeUpdateQueue\"}),\" \\uFF0C\\u5176\\u4E2D\\u65B0\\u5EFA\\u4E86\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"UpdateQueue\u003cState\u003e\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8D4B\\u503C\\u7ED9\",(0,n.jsx)(e.code,{children:\"uninitializedFibe.updateQueue\"}),\" \\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"markContainerAsRoot\"}),\"\\u5B9E\\u9645\\u4E0A\\u5C31\\u662F\\u628A\\u4E0A\\u9762\\u7684 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u8D4B\\u503C\\u7ED9 \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u7684\",(0,n.jsx)(e.code,{children:\"internalContainerInstanceKey\"}),\" \\u5C5E\\u6027\\u3002\\u65B9\\u4FBF\\u901A\\u8FC7\\u5143\\u7D20\\u83B7\\u53D6\\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"fiber\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`function ReactDOMRoot(internalRoot: FiberRoot) {\n  this._internalRoot = internalRoot;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5B9E\\u9645\\u4E0A\\u662F\\u751F\\u6210\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"ReactDomRoot\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u628A\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u751F\\u6210\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u8D4B\\u503C\\u7ED9\\u4ED6\\u7684 \",(0,n.jsx)(e.code,{children:\"_internalRoot\"}),\" \\u5C5E\\u6027\\uFF0C\\u81F3\\u6B64\\uFF0C\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7ED3\\u675F\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u7ED3\\u8BBA\",children:\"\\u7ED3\\u8BBA\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6240\\u4EE5 createRoot \\u7684\\u7ED3\\u679C\\u662F\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"createRootImp\"}),\" \\u51FD\\u6570\\uFF0C\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"FiberRootNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u662F \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"fiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684  \",(0,n.jsx)(e.code,{children:\"FiberNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u5E76\\u4E14\\u5C06\",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u7684  \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\"\\uFF0C\",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"stateNode\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"root\"}),\";\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4FEE\\u6539 \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u7684\\u5C5E\\u6027\",(0,n.jsx)(e.code,{children:\"internalContainerInstanceKey\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6700\\u540E\\u8FD4\\u56DE\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"ReactDomRoot\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u5B83\\u7684 \",(0,n.jsx)(e.code,{children:\"_internalRoot\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"root\\u3002\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u96BE\\u70B9\",children:\"\\u96BE\\u70B9\"}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5BF9\\u4E8E\\u4E0A\\u9762\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u53EF\\u4EE5\\u7B80\\u5316\\u79F0\\u4E3A \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"})]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u8868\\u793A\\u6574\\u4E2A React \\u5E94\\u7528\\u7684\\u6839\\u7EC4\\u4EF6\\uFF0C\\u5B83\\u662F \",(0,n.jsx)(e.code,{children:\"ReactFiberRoot\"}),\" \\u7C7B\\u578B\\u7684\\u5BF9\\u8C61\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u8868\\u793A\\u7EC4\\u4EF6\\u6811\\u7684\\u6839\\u8282\\u70B9\\uFF0C\\u5B83\\u662F \",(0,n.jsx)(e.code,{children:\"ReactFiber\"}),\" \\u7C7B\\u578B\\u7684\\u5BF9\\u8C61\\u3002\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u8D1F\\u8D23\\u7BA1\\u7406\\u6574\\u4E2A\\u5E94\\u7528\\u7684\\u7EC4\\u4EF6\\u6811\\uFF0C\\u5B83\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\u5C5E\\u6027\\uFF08\\u6307\\u5411\",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\uFF09 \\uFF0C\\u8868\\u793A\\u7EC4\\u4EF6\\u6811\\u7684\\u6839\\u8282\\u70B9\\u3002\\u5F53\\u521B\\u5EFA\\u4E00\\u4E2A\\u7EC4\\u4EF6\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u4F1A\\u521B\\u5EFA\\u4E00\\u4E2A\\u65B0\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\uFF0C\\u5E76\\u5C06\\u5B83\\u8D4B\\u503C\\u7ED9\\u7EC4\\u4EF6\\u7684 \",(0,n.jsx)(e.code,{children:\"_reactInternalFiber\"}),\" \\u5C5E\\u6027\\u3002\\u5F53\\u7EC4\\u4EF6\\u88AB\\u9500\\u6BC1\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u4F1A\\u91CA\\u653E\\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u8D1F\\u8D23\\u7BA1\\u7406\\u7EC4\\u4EF6\\u6811\\u7684\\u4E00\\u4E2A\\u8282\\u70B9\\u3002\\u5B83\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"children\"}),\" \\u6570\\u7EC4\\uFF0C\\u8868\\u793A\\u8BE5\\u8282\\u70B9\\u7684\\u5B50\\u8282\\u70B9\\uFF1B\\u5F53\\u6DFB\\u52A0\\u6216\\u5220\\u9664\\u5B50\\u8282\\u70B9\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u4F1A\\u81EA\\u52A8\\u66F4\\u65B0\\u5176 \",(0,n.jsx)(e.code,{children:\"children\"}),\" \\u6570\\u7EC4\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"render\",children:(0,n.jsx)(e.code,{children:\"render\"})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5177\\u4F53\\u628A react \\u7EC4\\u4EF6\\u6E32\\u67D3\\u5230\\u9875\\u9762\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`... = ReactDOMRoot.prototype.render =\n  function (children: ReactNodeList): void {\n    const root = this._internalRoot;\n\t\t...\n    updateContainer(children, root, null, null);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"this._internalRoot\"}),\" \\u62FF\\u5230\\u4E0A\\u9762 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\uFF0C\\u8FDB\\u5165\\u6838\\u5FC3\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"updateConatiner\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-reconciler/src/ReactFiberReconciler.old.js\nexport function updateContainer(\n  element: ReactNodeList,\n  container: OpaqueRoot,\n  parentComponent: ?React$Component\u003cany, any\u003e,\n  callback: ?Function,\n): Lane {\n  \\xB7\\xB7\\xB7\n\t// 1. \\u62FF\\u5230 rootFiber, \\u5F53\\u524D\\u66F4\\u65B0\\u7684\\u65F6\\u95F4\\u6233 eventTime\\uFF0C\n\t// \\u4EE5\\u53CA\\u66F4\\u65B0\\u7684\\u4F18\\u5148\\u7EA7 lane\\uFF0C\\u5F53\\u524D\\u66F4\\u65B0\\u7684\\u4E0A\\u4E0B\\u6587 context\n  const current = container.current;\n  const eventTime = requestEventTime();\n  const lane = requestUpdateLane(current);\n\n\t// enableSchedulingProfiler \\u4E3A\\u5185\\u90E8\\u6536\\u96C6\\u6027\\u80FD\\u6570\\u636E\\u7684\\u542F\\u52A8\\u5F00\\u5173\\uFF0C\\u53EF\\u4EE5\\u4E0D\\u5FC5\\u7406\\u4F1A\n  if (enableSchedulingProfiler) {\n    markRenderScheduled(lane);\n  }\n\n  const context = getContextForSubtree(parentComponent);\n  if (container.context === null) {\n    container.context = context;\n  } else {\n    container.pendingContext = context;\n  }\n\n  \\xB7\\xB7\\xB7\n\n  // 2. \\u521B\\u5EFA\\u66F4\\u65B0\\u4EFB\\u52A1\n  const update = createUpdate(eventTime, lane);\n  // Caution: React DevTools currently depends on this property\n  // being called \"element\".\n  update.payload = {element};\n\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    \\xB7\\xB7\\xB7\n    update.callback = callback;\n  }\n\n  // 3. update \\u5165\\u961F\\uFF0C\\u8FD4\\u56DE update \\u7684 fiberRoot\n  const root = enqueueUpdate(current, update, lane);\n  if (root !== null) {\n    // 4. \\u544A\\u8BC9 scheduler \\u8981\\u5BF9 fiber \\u8FDB\\u884C\\u5904\\u7406\n    scheduleUpdateOnFiber(root, current, lane, eventTime);\n    // 5. \\u5904\\u7406\\u975E\\u7D27\\u6025\\u66F4\\u65B0 transition\n    entangleTransitions(root, current, lane);\n  }\n\n  return lane;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53C2\\u6570 \",(0,n.jsx)(e.code,{children:\"element\"}),\" \\uFF1A\\u4E3A\\u5C06\\u88AB\\u6E32\\u67D3\\u7684\\u7EC4\\u4EF6\\u6811\\uFF0C\\u4F8B\\u5982 \",(0,n.jsx)(e.code,{children:\"\u003cMyPage/\u003e\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53C2\\u6570 \",(0,n.jsx)(e.code,{children:\"container\"}),\" \\uFF1A \\u4E3A\\u524D\\u4E00\\u6B65\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\u521B\\u5EFA\\u7684 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53D8\\u91CF \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\uFF1A\\u4E3A\\u524D\\u4E00\\u6B65\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\u521B\\u5EFA\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"requestUpdateLane\"}),\" \\uFF1A\\u6839\\u636E\\u5F53\\u524D\\u7684\\u66F4\\u65B0\\u7C7B\\u578B\\u83B7\\u5F97\\u5176 \",(0,n.jsx)(e.code,{children:\"lane\"}),\" \\u503C\\uFF08\\u4F18\\u5148\\u7EA7\\uFF09\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"getContextForSubtree\"}),\"\\uFF1A\\u83B7\\u53D6\\u7EC4\\u4EF6\\u6811\\u4E2D\\u4E00\\u4E2A\\u7EC4\\u4EF6\\u7684\\u4E0A\\u4E0B\\u6587\\u5BF9\\u8C61\",(0,n.jsx)(e.code,{children:\"context\"}),\" \\uFF0C \\u8FD9\\u4E0D\\u662F\\u6240\\u8C13\\u7684\\u72B6\\u6001\\u7BA1\\u7406\\u65B9\\u6848\\u7684 \",(0,n.jsx)(e.code,{children:\"context\"}),\";\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"createUpdate\"}),\" \\uFF1A\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5BF9\\u8C61\\uFF0C\\u5C06\\u7EC4\\u4EF6\\u6811\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\"\\uFF1B\",(0,n.jsx)(e.code,{children:\"callback\"}),\" \\u4E3A\\u6E32\\u67D3\\u540E\\u8981\\u6267\\u884C\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"enqueueUpdate\"}),\" \\uFF1A\\u5C06 \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5B58\\u5165\\u66F4\\u65B0\\u961F\\u5217\\uFF0C\\u8FD9\\u91CC\\u662F\\u5B58\\u5728\\u53D8\\u91CF \",(0,n.jsx)(e.code,{children:\"concurrentQueues\"}),\" \\u4E2D\\uFF0C\\u8BE5\\u53D8\\u91CF\\u7528\\u4E8E\\u5B58\\u653E\\u5F53\\u524D\\u6B63\\u5728\\u5904\\u7406\\u7684\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6838\\u5FC3\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"scheduleUpdateOnFiber\"}),\"  \\uFF1A\\u7528\\u4E8E\\u8C03\\u5EA6\\u5904\\u7406\\u7EC4\\u4EF6\\u7684\\u66F4\\u65B0\\u3002\\u4E5F\\u5C31\\u662F\\u8C03\\u7528 scheduler \\u7684 api\\uFF0C\\u5C06\\u6E32\\u67D3\\u4EFB\\u52A1\\u5C01\\u88C5\\u6210 \",(0,n.jsx)(e.code,{children:\"task\"}),\" \\u7B49\\u5F85\\u88AB\\u6267\\u884C\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"entangleTransitions\"}),\" \\uFF1A\\u5904\\u7406 \",(0,n.jsx)(e.code,{children:\"transition\"}),\" \\u7684\\u66F4\\u65B0\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5BF9\\u8C61\\uFF0C\\u4ECE\\u521D\\u6B21\\u6E32\\u67D3\\u53EF\\u4EE5\\u770B\\u51FA\\uFF0C\\u7EC4\\u4EF6\\u6811\\uFF08\",(0,n.jsx)(e.code,{children:\"elment\"}),\"\\uFF09\\u88AB\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\" \\u653E\\u7F6E\\u5230\\u5B9E\\u4F8B\\u4E2D\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createUpdate(eventTime: number, lane: Lane): Update\u003cmixed\u003e {\n  const update: Update\u003cmixed\u003e = {\n    eventTime,\n    lane,\n\n    tag: UpdateState,\n    payload: null,\n    callback: null,\n\n    next: null,\n  };\n  return update;\n}\n`})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// createRoot \\u4E2D updateQueue \\u7684\\u521D\\u59CB\\u5316\nexport function initializeUpdateQueue\u003cState\u003e(fiber: Fiber): void {\n  const queue: UpdateQueue\u003cState\u003e = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      lanes: NoLanes,\n      hiddenCallbacks: null,\n    },\n    callbacks: null,\n  };\n  fiber.updateQueue = queue;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u52A0\\u5165 \",(0,n.jsx)(e.code,{children:\"updateQueue\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function enqueueUpdate\u003cState\u003e(\n  fiber: Fiber,\n  update: Update\u003cState\u003e,\n  lane: Lane,\n): FiberRoot | null {\n  const updateQueue = fiber.updateQueue;\n  if (updateQueue === null) {\n    // Only occurs if the fiber has been unmounted.\n    return null;\n  }\n\n  const sharedQueue: SharedQueue\u003cState\u003e = (updateQueue: any).shared;\n\n  if (isUnsafeClassRenderPhaseUpdate(fiber)) {\n    // This is an unsafe render phase update. Add directly to the update\n    // queue so we can process it immediately during the current render.\n    const pending = sharedQueue.pending;\n    if (pending === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n    } else {\n      update.next = pending.next;\n      pending.next = update;\n    }\n    sharedQueue.pending = update;\n\n    // Update the childLanes even though we're most likely already rendering\n    // this fiber. This is for backwards compatibility in the case where you\n    // update a different component during render phase than the one that is\n    // currently renderings (a pattern that is accompanied by a warning).\n    return unsafe_markUpdateLaneFromFiberToRoot(fiber, lane);\n  } else {\n    return enqueueConcurrentClassUpdate(fiber, sharedQueue, update, lane);\n  }\n}\n`})}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u603B\\u7ED3\",children:\"\\u603B\\u7ED3\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u4E2D\\uFF0C\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\uFF0C\\u5E76\\u521D\\u59CB\\u5316\\u4E86 \",(0,n.jsx)(e.code,{children:\"updateQueue\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"render\"}),\"  \\u4E2D\\uFF0C\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\uFF0C\\u5E76\\u5C06\\u7EC4\\u4EF6\\u6811\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\" \\uFF0C\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"scheduleUpdateOnFiber\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4E00\\u4E9B\\u8865\\u5145\",children:\"\\u4E00\\u4E9B\\u8865\\u5145\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8865\\u5145\\u4E00\\u4E9B\\u4E0D\\u662F\\u7279\\u522B\\u91CD\\u8981\\u7684\\u5185\\u5BB9\\u3002\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\uFF0C\\u8FD9\\u91CC\\u662F react \\u5185\\u90E8\\u6982\\u5FF5\\u4E0B\\uFF0C\\u5E76\\u975E\\u51FD\\u6570\\u6982\\u5FF5\\u4E0B\\u7684\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u3002\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"NoContext\"}),\" \\u8868\\u793A\\u6CA1\\u6709\\u4E0A\\u4E0B\\u6587\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"BatchedContext\"}),\" \\u8868\\u793A\\u6279\\u91CF\\u66F4\\u65B0\\u4E0A\\u4E0B\\u6587\\uFF0C\\u540C\\u65F6\\u6709\\u591A\\u4E2A setState\\uFF0C\\u6B64\\u65F6\\u4E3A\\u6279\\u91CF\\u66F4\\u65B0\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"RenderContext\"}),\" \\u8868\\u793A\\u6E32\\u67D3\\u4E0A\\u4E0B\\u6587\\uFF0C\\u901A\\u5E38 react \\u6E32\\u67D3\\u5206\\u4E3A render \\u548C commit \\u9636\\u6BB5\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"CommitContext\"}),` \\u8868\\u793A\\u63D0\\u4EA4\\u4E0A\\u4E0B\\u6587\\u3002\n\\u8FD9\\u4E9B\\u53D8\\u91CF\\u7528\\u4E8E\\u8868\\u793A\\u7EC4\\u4EF6\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\u7684\\u72B6\\u6001\\uFF0C\\u4EE5\\u4FBF\\u4E8E\\u66F4\\u597D\\u5730\\u7BA1\\u7406\\u548C\\u4F18\\u5316\\u3002`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"updateQueue\"}),\"  \\u4E2D\\u8FD8\\u6709 \",(0,n.jsx)(e.code,{children:\"shared\"}),\" \\u5C5E\\u6027\\uFF0C\\u88AB\\u79F0\\u4E3A \",(0,n.jsx)(e.code,{children:\"shareQueue\"}),` \\u3002\n`,(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\"\\u7B80\\u5355\\u8BB2 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u5B58\\u653E\\u5F02\\u6B65\\u4EFB\\u52A1\\uFF0C\",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),` \\u5B58\\u653E\\u540C\\u6B65\\u4EFB\\u52A1\\u3002\n\\u7EC4\\u4EF6\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\uFF0C\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u7EC4\\u4EF6\\u5185\\u90E8\\u7684\\u51FD\\u6570\\uFF08\\u4F8B\\u5982`,(0,n.jsx)(e.code,{children:\"useEffect\"}),\" \\u6216 \",(0,n.jsx)(e.code,{children:\"useCallback\"}),\"\\uFF09\\u3002\\u5B83\\u4EEC\\u901A\\u5E38\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u4EA7\\u751F sideEffect \\u7684\\u4EE3\\u7801\\uFF0C\\u5982\\u8BBE\\u7F6E \",(0,n.jsx)(e.code,{children:\"timer\"}),\"\\uFF0C\\u4FEE\\u6539 \",(0,n.jsx)(e.code,{children:\"DOM\"}),\"\\u3001\\u8C03\\u6574 \",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u7B49\\u3002React \\u901A\\u8FC7\\u5C06 sideEffect \\u5B58\\u50A8\\u5728 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\" \\uFF0C\\u5E76\\u5728\\u9002\\u5F53\\u7684\\u65F6\\u673A\\u6267\\u884C\\u5B83\\u4EEC\\u6765\\u63D0\\u9AD8\\u6027\\u80FD\\u3002\"]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"updateQueue\"}),\"\\uFF1A\\u8FD9\\u4E2A\\u961F\\u5217\\u7528\\u4E8E\\u5B58\\u50A8\\u9700\\u8981\\u5728\\u4E0B\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\u6267\\u884C\\u7684\\u66F4\\u65B0\\u64CD\\u4F5C\\uFF08\\u8FD9\\u91CC\\u662F react \\u4E2D\\u5F02\\u6B65\\u4EFB\\u52A1\\u7684\\u6982\\u5FF5\\uFF0C\\u5373\\u4EA7\\u751F\\u66F4\\u65B0\\u64CD\\u4F5C\\u5728\\u4E0B\\u6B21\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u6267\\u884C\\uFF09\\uFF0C\\u4F8B\\u5982\\u7EC4\\u4EF6\\u7684 \",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u53D1\\u751F\\u53D8\\u5316\\u65F6\\uFF0C\\u5B83\\u4F1A\\u5C06\\u66F4\\u65B0\\u64CD\\u4F5C\\u6DFB\\u52A0\\u5230 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u4E2D\\u3002\\u5728\\u4E0B\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u88AB\\u53D6\\u51FA\\u5E76\\u6267\\u884C\\uFF0C\\u4ECE\\u800C\\u66F4\\u65B0\\u7EC4\\u4EF6\\u7684 UI\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\"\\uFF1A\\u8FD9\\u4E2A\\u961F\\u5217\\u7528\\u4E8E\\u5B58\\u50A8\\u5728\\u5F53\\u524D\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\u6267\\u884C\\u7684\\u540C\\u6B65\\u4EFB\\u52A1\\u3002\\u5F53\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"useEffect\"}),\" \\u6216 \",(0,n.jsx)(e.code,{children:\"useCallback\"}),\" Hook \\u65F6\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u5728\\u7EC4\\u4EF6\\u7684\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\u6267\\u884C\\u4E00\\u4E2A\\u51FD\\u6570\\uFF0C\\u8FD9\\u4E2A\\u51FD\\u6570\\u901A\\u5E38\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u4EA7\\u751F sideEffect \\u7684\\u4EE3\\u7801\\u3002\\u8FD9\\u4E9B sideEffect \\u5728\\u7EC4\\u4EF6\\u7684\\u6E32\\u67D3\\u5B8C\\u6210\\u540E\\u624D\\u4F1A\\u6267\\u884C\\uFF0C\\u56E0\\u6B64\\u5B83\\u4EEC\\u662F\\u540C\\u6B65\\u7684\\u3002\\u5F53\\u6267\\u884C\\u5B8C\\u6210\\u540E\\uFF0C\\u5B83\\u4F1A\\u5C06\\u66F4\\u65B0\\u64CD\\u4F5C\\u6DFB\\u52A0\\u5230 \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\" \\u4E2D\\u3002\\u5728\\u540C\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u88AB\\u53D6\\u51FA\\u5E76\\u6267\\u884C\\uFF0C\\u4ECE\\u800C\\u66F4\\u65B0\\u7EC4\\u4EF6\\u7684 UI\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD9\\u6837\\u505A\\u76EE\\u7684\\u662F\\u66F4\\u6709\\u6548\\u5730\\u7BA1\\u7406\\u548C\\u7EC4\\u7EC7\\u4EFB\\u52A1\\uFF0C\\u4ECE\\u800C\\u63D0\\u9AD8\\u6027\\u80FD\\u3002\"})]})}function C(r={}){let{wrapper:e}=r.components||{};return e?(0,n.jsx)(e,Object.assign({},r,{children:(0,n.jsx)(h,r)})):h(r)}var x=C;return F(y);})();\n;return Component;"},"__N_SSG":true},"page":"/[[...id]]","query":{"id":["react-src","first-render"]},"buildId":"td-76pZFZwbyBb6fsZog8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>