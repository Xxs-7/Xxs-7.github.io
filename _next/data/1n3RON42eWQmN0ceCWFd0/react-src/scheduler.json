{"pageProps":{"toc":[{"text":"scheduler","hash":"#scheduler","depth":1},{"text":"通过浏览器空闲时间执行任务","hash":"#通过浏览器空闲时间执行任务","depth":2},{"text":"关于任务队列","hash":"#关于任务队列","depth":3},{"text":"工作原理","hash":"#工作原理","depth":2},{"text":"任务","hash":"#任务","depth":2},{"text":"优先级","hash":"#优先级","depth":2},{"text":"中断和恢复","hash":"#中断和恢复","depth":2},{"text":"拆分","hash":"#拆分","depth":2}],"code":"var Component=(()=>{var d=Object.create;var s=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),k=(r,e)=>{for(var l in e)s(r,l,{get:e[l],enumerable:!0})},c=(r,e,l,t)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let h of m(e))!p.call(r,h)&&h!==l&&s(r,h,{get:()=>e[h],enumerable:!(t=u(e,h))||t.enumerable});return r};var M=(r,e,l)=>(l=r!=null?d(f(r)):{},c(e||!r||!r.__esModule?s(l,\"default\",{value:r,enumerable:!0}):l,r)),j=r=>c(s({},\"__esModule\",{value:!0}),r);var a=g((C,i)=>{i.exports=_jsx_runtime});var b={};k(b,{default:()=>S});var n=M(a());function o(r){let e=Object.assign({h1:\"h1\",p:\"p\",code:\"code\",h2:\"h2\",pre:\"pre\",h3:\"h3\",ul:\"ul\",li:\"li\",a:\"a\",ol:\"ol\",strong:\"strong\"},r.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{hash:\"scheduler\",children:\"scheduler\"}),`\n`,(0,n.jsx)(e.p,{children:\"scheduler \\u5B9E\\u9645\\u548C react \\u7684\\u7EC4\\u4EF6\\u6E32\\u67D3\\u7684\\u4EE3\\u7801\\u662F\\u72EC\\u7ACB\\u7684\\uFF0Cscheduler \\u5B83\\u662F\\u4E00\\u79CD\\u901A\\u7528\\u8BBE\\u8BA1\\uFF0C\\u53EA\\u8D1F\\u8D23\\u8C03\\u5EA6\\uFF0C\\u548C\\u5904\\u7406\\u5177\\u4F53\\u6E32\\u67D3\\u7684\\u4EE3\\u7801\\u65E0\\u5173\\u3002\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5728\\u6E90\\u7801\\u4E2D Scheduler \\u662F react \\u5355\\u72EC\\u5B9E\\u73B0\\u7684\\u4EFB\\u52A1\\u8C03\\u5EA6\\u5E93\\u3002\\u5B83\\u4E5F\\u53EF\\u4EE5\\u5B9E\\u73B0\\u5728\\u6D4F\\u89C8\\u5668\\u7A7A\\u95F2\\u65F6\\u6267\\u884C\\u4EFB\\u52A1\\uFF0C\\u800C\\u4E14\\u8FD8\\u53EF\\u4EE5\\u8BBE\\u7F6E\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\uFF0C\\u9AD8\\u4F18\\u5148\\u7EA7\\u4EFB\\u52A1\\u5148\\u6267\\u884C\\uFF0C\\u4F4E\\u4F18\\u5148\\u7EA7\\u4EFB\\u52A1\\u540E\\u6267\\u884C\\u3002 Scheduler \\u5B58\\u50A8\\u5728\\xA0\",(0,n.jsx)(e.code,{children:\"packages/scheduler\"}),\"\\xA0\\u6587\\u4EF6\\u5939\\u4E2D\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u901A\\u8FC7\\u6D4F\\u89C8\\u5668\\u7A7A\\u95F2\\u65F6\\u95F4\\u6267\\u884C\\u4EFB\\u52A1\",children:\"\\u901A\\u8FC7\\u6D4F\\u89C8\\u5668\\u7A7A\\u95F2\\u65F6\\u95F4\\u6267\\u884C\\u4EFB\\u52A1\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E0D\\u662F\\u5229\\u7528 JS \\u4E3B\\u7EBF\\u7A0B\\u800C\\u662F\\u901A\\u8FC7\\u6D4F\\u89C8\\u5668\\u7A7A\\u95F2\\u65F6\\u95F4\\u6267\\u884C\\u4EFB\\u52A1\\uFF0C\\u53EF\\u4EE5\\u63D0\\u9AD8\\u9875\\u9762\\u7684\\u54CD\\u5E94\\u6027\\uFF0C\\u9AD8\\u6548\\u7684\\u5229\\u7528\\u6D4F\\u89C8\\u5668\\u6027\\u80FD\\u3002\\u5229\\u7528\\u6D4F\\u89C8\\u5668\\u7684\\u4EFB\\u52A1\\u961F\\u5217\\uFF0C\\u53EF\\u4EE5\\u5B9E\\u73B0\\u8FD9\\u4E00\\u76EE\\u6807\\u3002\"}),`\n`,(0,n.jsx)(e.p,{children:\"react \\u4F7F\\u7528\\u4E86 messageChannel \\u7684\\u65B9\\u6848\\uFF0C\\u5C06\\u66F4\\u65B0\\u6E32\\u67D3\\u4EFB\\u52A1\\u4F5C\\u4E3A\\u5B8F\\u4EFB\\u52A1\\uFF0C\\u6765\\u8BA9\\u6E21\\u4E3B\\u7EBF\\u7A0B\\u3002\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-JavaScript\",children:`// react/packages/scheduler/src/forks/Scheduler.js\nlet schedulePerformWorkUntilDeadline;\nif (typeof localSetImmediate === 'function') { // \\u517C\\u5BB9\\u65E7\\u7248 IE \\u548C NodeJs\\uFF0C\\u4F7F\\u7528 setImmediate\n  // Node.js and old IE.\n  // There's a few reasons for why we prefer setImmediate.\n  //\n  // Unlike MessageChannel, it doesn't prevent a Node.js process from exiting.\n  // (Even though this is a DOM fork of the Scheduler, you could get here\n  // with a mix of Node.js 15+, which has a MessageChannel, and jsdom.)\n  // https://github.com/facebook/react/issues/20756\n  //\n  // But also, it runs earlier which is the semantic we want.\n  // If other browsers ever implement it, it's better to use it.\n  // Although both of these would be inferior to native scheduling.\n  schedulePerformWorkUntilDeadline = () => {\n    localSetImmediate(performWorkUntilDeadline);\n  };\n} else if (typeof MessageChannel !== 'undefined') { // \\u5982\\u679C\\u8FD0\\u884C\\u73AF\\u5883\\u652F\\u6301 MessageChannel\n  // DOM and Worker environments.\n  // We prefer MessageChannel because of the 4ms setTimeout clamping.\n  const channel = new MessageChannel();\n  const port = channel.port2;\n  channel.port1.onmessage = performWorkUntilDeadline;\n  schedulePerformWorkUntilDeadline = () => {\n    port.postMessage(null);\n  };\n} else { // \\u6700\\u574F\\u6253\\u7B97\\uFF0C\\u4F7F\\u7528 setTimeout\n  // We should only fallback here in non-browser environments.\n  schedulePerformWorkUntilDeadline = () => {\n    // $FlowFixMe[not-a-function] nullable value\n    localSetTimeout(performWorkUntilDeadline, 0);\n  };\n}\n`})}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u5173\\u4E8E\\u4EFB\\u52A1\\u961F\\u5217\",children:\"\\u5173\\u4E8E\\u4EFB\\u52A1\\u961F\\u5217\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6D4F\\u89C8\\u5668\\u63D0\\u4F9B\\u7684\\u5173\\u4E8E\\u4EFB\\u52A1\\u961F\\u5217\\u7684 API\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"setTimeout\"}),\"\\uFF1A\\u81F3\\u5C11\\u4F1A\\u6709 4ms \\u7684\\u5EF6\\u8FDF\\uFF0C\\u5E76\\u4E14\\u5D4C\\u5957\\u4F7F\\u7528\\u5EF6\\u8FDF\\u65F6\\u95F4\\u4F1A\\u88AB\\u53E0\\u52A0\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"requestAnimationFrame\"}),\"\\uFF1A\\u7531\\u4E8E\\u6D4F\\u89C8\\u5668\\u5185\\u6838\\u673A\\u5236\\uFF0C\\u6709\\u65F6\\u5B58\\u5728 \",(0,n.jsx)(e.a,{href:\"https://medium.com/@paul_irish/requestanimationframe-scheduling-for-nerds-9c57f7438ef4\",children:\"\\u4E22\\u5E27\"}),\" \\u7684\\u60C5\\u51B5\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"requestIdleCallback\"}),\"\\uFF1A\\u517C\\u5BB9\\u6027\\u5DEE\\uFF0C\\u5E76\\u4E14\\u5176\\u5B9E\\u9645\\u7684 FPS \\u53EA\\u6709 20ms\\uFF0C\\u6B63\\u5E38\\u60C5\\u51B5\\u4E0B\\u6E32\\u67D3\\u4E00\\u5E27\\u65F6\\u957F\\u63A7\\u5236\\u5728 16.67ms (1s / 60 = 16.67ms)\\u3002\\u8BE5\\u65F6\\u95F4\\u662F\\u9AD8\\u4E8E\\u9875\\u9762\\u6D41\\u7545\\u7684\\u8BC9\\u6C42\\uFF0C\",(0,n.jsx)(e.a,{href:\"https://juejin.cn/post/7061947637167194142#heading-3\",children:\"\\u53C2\\u8003\"}),\"\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"MessageChannel\"}),\"\\uFF1A\\u6D4F\\u89C8\\u5668\\u63D0\\u4F9B\\uFF0C\\u7528\\u4E8E\\u521B\\u5EFA\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"MessagePort\"}),\" \\u5BF9\\u8C61\\uFF0C\\u5B83\\u5141\\u8BB8\\u4E24\\u4E2A\\u8FD0\\u884C\\u5728\\u4E0A\\u4E0B\\u6587\\u4E2D\\u7684\\u811A\\u672C\\u8FDB\\u884C\\u901A\\u4FE1\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u5DE5\\u4F5C\\u539F\\u7406\",children:\"\\u5DE5\\u4F5C\\u539F\\u7406\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\"}),\"\\uFF1AReact \\u7684 Scheduler \\u6839\\u636E\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\u6765\\u51B3\\u5B9A\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\u987A\\u5E8F\\u3002React \\u5C06\\u4EFB\\u52A1\\u5206\\u4E3A\\u4E0D\\u540C\\u7684\\u4F18\\u5148\\u7EA7\\uFF0C\\u4F8B\\u5982\\u6E32\\u67D3\\u4F18\\u5148\\u7EA7\\u3001\\u52A8\\u753B\\u4F18\\u5148\\u7EA7\\u7B49\\u3002\\u6BCF\\u4E2A\\u4F18\\u5148\\u7EA7\\u90FD\\u6709\\u4E00\\u4E2A\\u76F8\\u5E94\\u7684\\u8C03\\u5EA6\\u961F\\u5217\\uFF0C\\u7528\\u4E8E\\u5B58\\u50A8\\u5F85\\u6267\\u884C\\u7684\\u4EFB\\u52A1\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u4EFB\\u52A1\\u7684\\u8C03\\u5EA6\"}),\"\\uFF1A\\u5728 React \\u4E2D\\uFF0C\\u4EFB\\u52A1\\u53EF\\u4EE5\\u662F\\u66F4\\u65B0\\u7EC4\\u4EF6\\u3001\\u6267\\u884C\\u526F\\u4F5C\\u7528\\uFF08\\u4F8B\\u5982\\u6570\\u636E\\u83B7\\u53D6\\u6216\\u52A8\\u753B\\u5904\\u7406\\uFF09\\u7B49\\u3002Scheduler \\u6839\\u636E\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\u548C\\u8C03\\u5EA6\\u7B56\\u7565\\uFF0C\\u51B3\\u5B9A\\u4F55\\u65F6\\u6267\\u884C\\u4EFB\\u52A1\\u3002React \\u4F7F\\u7528\\u5F02\\u6B65\\u7684\\u65B9\\u5F0F\\u6267\\u884C\\u4EFB\\u52A1\\uFF0C\\u4EE5\\u907F\\u514D\\u963B\\u585E\\u4E3B\\u7EBF\\u7A0B\\uFF0C\\u63D0\\u9AD8\\u5E94\\u7528\\u7A0B\\u5E8F\\u7684\\u54CD\\u5E94\\u6027\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u4EFB\\u52A1\\u7684\\u4E2D\\u65AD\\u4E0E\\u6062\\u590D\"}),\"\\uFF1AReact \\u7684 Scheduler \\u5141\\u8BB8\\u5728\\u4EFB\\u52A1\\u6267\\u884C\\u8FC7\\u7A0B\\u4E2D\\u4E2D\\u65AD\\u548C\\u6062\\u590D\\u4EFB\\u52A1\\u3002\\u8FD9\\u662F\\u4E3A\\u4E86\\u4FDD\\u8BC1\\u9AD8\\u4F18\\u5148\\u7EA7\\u4EFB\\u52A1\\u7684\\u53CA\\u65F6\\u54CD\\u5E94\\u3002\\u5F53\\u51FA\\u73B0\\u5177\\u6709\\u66F4\\u9AD8\\u4F18\\u5148\\u7EA7\\u7684\\u4EFB\\u52A1\\u65F6\\uFF0CReact \\u53EF\\u4EE5\\u4E2D\\u65AD\\u5F53\\u524D\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\uFF0C\\u5E76\\u6267\\u884C\\u66F4\\u9AD8\\u4F18\\u5148\\u7EA7\\u7684\\u4EFB\\u52A1\\u3002\\u4E00\\u65E6\\u9AD8\\u4F18\\u5148\\u7EA7\\u4EFB\\u52A1\\u5B8C\\u6210\\uFF0CReact \\u4F1A\\u6062\\u590D\\u4E2D\\u65AD\\u7684\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u4EFB\\u52A1\\u7684\\u62C6\\u5206\\u548C\\u5212\\u5206\"}),\"\\uFF1A\\u4E3A\\u4E86\\u66F4\\u597D\\u5730\\u63A7\\u5236\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\u548C\\u4F18\\u5148\\u7EA7\\uFF0CReact \\u53EF\\u4EE5\\u5C06\\u4EFB\\u52A1\\u62C6\\u5206\\u4E3A\\u66F4\\u5C0F\\u7684\\u4EFB\\u52A1\\u5355\\u5143\\uFF0C\\u5E76\\u6839\\u636E\\u4EFB\\u52A1\\u7684\\u91CD\\u8981\\u6027\\u548C\\u4F18\\u5148\\u7EA7\\u8FDB\\u884C\\u5212\\u5206\\u3002\\u8FD9\\u6837\\u53EF\\u4EE5\\u5728\\u591A\\u4E2A\\u5E27\\u4E2D\\u5206\\u914D\\u4EFB\\u52A1\\u6267\\u884C\\uFF0C\\u4EE5\\u4FDD\\u6301\\u5E94\\u7528\\u7A0B\\u5E8F\\u7684\\u6D41\\u7545\\u6027\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u901A\\u8FC7 Scheduler \\u7684\\u5DE5\\u4F5C\\uFF0CReact \\u80FD\\u591F\\u5B9E\\u73B0\\u4EFB\\u52A1\\u7684\\u4F18\\u5148\\u7EA7\\u8C03\\u5EA6\\u3001\\u4E2D\\u65AD\\u548C\\u6062\\u590D\\uFF0C\\u4EE5\\u53CA\\u4EFB\\u52A1\\u7684\\u62C6\\u5206\\u548C\\u5212\\u5206\\u3002\\u8FD9\\u6837\\uFF0CReact \\u53EF\\u4EE5\\u66F4\\u597D\\u5730\\u7BA1\\u7406\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\u987A\\u5E8F\\uFF0C\\u5E76\\u6839\\u636E\\u4EFB\\u52A1\\u7684\\u91CD\\u8981\\u6027\\u548C\\u4F18\\u5148\\u7EA7\\u6765\\u63D0\\u4F9B\\u66F4\\u597D\\u7684\\u7528\\u6237\\u4F53\\u9A8C\\u548C\\u54CD\\u5E94\\u6027\\u80FD\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4EFB\\u52A1\",children:\"\\u4EFB\\u52A1\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4F18\\u5148\\u7EA7\",children:\"\\u4F18\\u5148\\u7EA7\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4E2D\\u65AD\\u548C\\u6062\\u590D\",children:\"\\u4E2D\\u65AD\\u548C\\u6062\\u590D\"}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u62C6\\u5206\",children:\"\\u62C6\\u5206\"})]})}function w(r={}){let{wrapper:e}=r.components||{};return e?(0,n.jsx)(e,Object.assign({},r,{children:(0,n.jsx)(o,r)})):o(r)}var S=w;return j(b);})();\n;return Component;"},"__N_SSG":true}