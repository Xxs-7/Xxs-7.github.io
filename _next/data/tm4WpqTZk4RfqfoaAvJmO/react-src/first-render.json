{"pageProps":{"toc":[{"text":"初次渲染的发起","hash":"#初次渲染的发起","depth":1},{"text":"剖析源码","hash":"#剖析源码","depth":2},{"text":"createRoot","hash":"#createroot","depth":2},{"text":"createRootImpl","hash":"#createrootimpl","depth":3},{"text":"结论","hash":"#结论","depth":3},{"text":"难点","hash":"#难点","depth":3},{"text":"render","hash":"#render","depth":2},{"text":"总结","hash":"#总结","depth":2},{"text":"一些补充","hash":"#一些补充","depth":2}],"code":"var Component=(()=>{var u=Object.create;var o=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var R=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),m=(r,e)=>{for(var t in e)o(r,t,{get:e[t],enumerable:!0})},d=(r,e,t,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let c of p(e))!f.call(r,c)&&c!==t&&o(r,c,{get:()=>e[c],enumerable:!(i=s(e,c))||i.enumerable});return r};var g=(r,e,t)=>(t=r!=null?u(b(r)):{},d(e||!r||!r.__esModule?o(t,\"default\",{value:r,enumerable:!0}):t,r)),F=r=>d(o({},\"__esModule\",{value:!0}),r);var a=R((k,l)=>{l.exports=_jsx_runtime});var y={};m(y,{default:()=>x});var n=g(a());function h(r){let e=Object.assign({h1:\"h1\",p:\"p\",code:\"code\",ul:\"ul\",li:\"li\",h2:\"h2\",pre:\"pre\",strong:\"strong\",a:\"a\",h3:\"h3\",ol:\"ol\"},r.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{hash:\"\\u521D\\u6B21\\u6E32\\u67D3\\u7684\\u53D1\\u8D77\",children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u7684\\u53D1\\u8D77\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u521D\\u6B21\\u6E32\\u67D3\\u505A\\u7684\\u4E8B\\uFF1A\\u5C06\\u5165\\u53E3\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7684\\u7EC4\\u4EF6\\u6811\\u6E32\\u67D3\\u5230\\u9875\\u9762\\u4E2D\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u5728 react \\u6E90\\u7801\\u7684\\u6267\\u884C\\u903B\\u8F91\\u4E2D\\uFF0C\\u6211\\u8BA4\\u4E3A\\u662F\\u53EF\\u4EE5\\u5206\\u6210\\u4E24\\u4E2A\\u90E8\\u5206\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6E32\\u67D3\\u4EFB\\u52A1\\u7684\\u521B\\u5EFA\\uFF0C\\u4E5F\\u5C31\\u662F \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u8FD9\\u4E2A\\u51FD\\u6570\\u7684\\u6267\\u884C\\u7ED3\\u679C\\uFF0C\\u5C06\\u6E32\\u67D3\\u4EFB\\u52A1\\u653E\\u7F6E\\u5230 scheduler \\u7684 \",(0,n.jsx)(e.code,{children:\"taskQueue\"}),\" \\u4E2D\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6E32\\u67D3\\u4EFB\\u52A1\\u7684\\u6267\\u884C\\uFF0C\\u4E5F\\u5C31\\u662F\\u5E38\\u8BF4\\u7684 render \\u548C commit \\u9636\\u6BB5\\uFF0C\\u5728 \",(0,n.jsx)(e.code,{children:\"taskQueue\"}),\" \\u4E2D\\u62FF\\u51FA\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u5E76\\u5728\\u5B8F\\u4EFB\\u52A1\\u4E2D\\u7684\\u4EE5\\u6D4F\\u89C8\\u5668\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u7684\\u65B9\\u5F0F\\u6267\\u884C\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD9\\uFF0C\\u4E0D\\u5C31\\u662F\\u591A\\u751F\\u4EA7\\u8005\\u5355\\u6D88\\u8D39\\u8005\\u7684\\u8BBE\\u8BA1\\u6A21\\u5F0F\\u5417\\uFF1F\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u672C\\u6587\\u4E3B\\u8981\\u8BB2 react \\u5E94\\u7528\\u4ECE\\u5F00\\u59CB\\u5230 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7ED3\\u675F\\u7684\\u8FC7\\u7A0B\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u5256\\u6790\\u6E90\\u7801\",children:\"\\u5256\\u6790\\u6E90\\u7801\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u521D\\u6B21\\u6E32\\u67D3\\u4E3B\\u8981\\u505A\\u7684\\u4E8B\\u60C5\\u662F\\u521D\\u59CB\\u5316\\u4E00\\u4E9B\\u6570\\u636E\\u7ED3\\u6784\\u5E76\\u521B\\u5EFA\\u6E32\\u67D3\\u4EFB\\u52A1\\uFF0C\\u79FB\\u4EA4\\u7ED9 scheduler \\u6267\\u884C\\u3002\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-tsx\",children:`const root = createRoot(document.getElementById(\"root\"));\nroot.render(<MyPage />);\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u662F react \\u8FDB\\u5165\\u4E3B\\u4F53\\u51FD\\u6570\\u7684\\u5165\\u53E3\\u4E4B\\u4E00\\uFF0C\\u5185\\u90E8\\u91C7\\u7528\\u7684\\u662F concurrent \\u6A21\\u5F0F\\u3002\",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://zh-hans.react.dev/blog/2022/03/29/react-v18#what-is-concurrent-react\",children:\"\\u4EC0\\u4E48\\u662F\\u5E76\\u53D1 React\\uFF1F\"})})})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"17 \\u4EE5\\u524D\\u5E38\\u7528\\u7684 \",(0,n.jsx)(e.code,{children:\"render\"}),\"  \\u4ECD\\u53EF\\u4EE5\\u4F7F\\u7528\\uFF0C\\u4E3A legacy \\u6A21\\u5F0F\\uFF0C\\u76F8\\u8F83\\u4E8E concurrent \\u6A21\\u5F0F\\u5C11\\u4E86 react 18 \\u4E2D transition \\u7B49\\u65B0\\u7279\\u6027\\u3002\",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://17.reactjs.org/docs/concurrent-mode-adoption.html#feature-comparison\",children:\"Feature Comparison\"})})]}),`\n`,(0,n.jsx)(e.h2,{hash:\"createroot\",children:(0,n.jsx)(e.code,{children:\"createRoot\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-dom/src/client/ReactDOM.js\nimport {\n  createRoot as createRootImpl,\n\t...\n} from './ReactDOMRoot';\n\nfunction createRoot(\n  container: Element | Document | DocumentFragment,\n  options?: CreateRootOptions,\n): RootType {\n\t...\n\n  return createRootImpl(container, options);\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"\\u53C2\\u6570\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"container\"}),\"\\uFF1A\\u53EF\\u4EE5\\u662F \",(0,n.jsx)(e.code,{children:\"Element | Document | DocumentFragment\"}),\"\\uFF0C\\u6B64\\u5904\\u4E3A\",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\uFF0C\\u5373\",(0,n.jsx)(e.code,{children:\"element\"}),\" \\uFF0C\\u5173\\u4E8E\\u8FD9\\u51E0\\u4E2A\\u539F\\u751F\\u6807\\u7B7E\\u7C7B\\u578B\\u53EF\\u4EE5\\u67E5\\u770B \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/zh-CN/docs/Web/API/Element\",children:\"Element\"}),\"  \\u4E86\\u89E3\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"options\\uFF1F\"}),\" \\uFF1A\\u53EF\\u9009\\uFF0C\\u914D\\u7F6E\\u9009\\u9879\\uFF0C\\u6B64\\u5904\\u503C \",(0,n.jsx)(e.code,{children:\"null\"}),\"\\uFF0C\\u7565\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{hash:\"createrootimpl\",children:(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.code,{children:\"createRootImpl\"})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"createRootImpl\"}),\"\\xA0\\u4E2D\",(0,n.jsx)(e.code,{children:\"impl\"}),\"\\u662F\",(0,n.jsx)(e.code,{children:\"implement\"}),\" \\u7684\\u7F29\\u5199\\uFF0C\\u5B9E\\u9645\\u662F ReactDOMRoot.js \\u7684 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\uFF0C\\u89C2\\u5BDF\\u4EE3\\u7801\\u53EF\\u4EE5\\u53D1\\u73B0\\uFF0C\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u8FD4\\u56DE\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u53D8\\u91CF\\u5C31\\u662F\\u8FD9\\u91CC\\u7684\\u503C\",(0,n.jsx)(e.code,{children:\"new ReactDOMRoot(root)\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-dom/src/client/ReactDOMRoot.js\nexport function createRoot(\n  container: Element | Document | DocumentFragment,\n  options?: CreateRootOptions,\n): RootType {\n\t...\n\n  let isStrictMode = false;\n  let concurrentUpdatesByDefaultOverride = false;\n  let identifierPrefix = '';\n  let onRecoverableError = defaultOnRecoverableError;\n  let transitionCallbacks = null;\n\n  ...\n\t// \\u6839\\u636E\\u4F20\\u5165\\u7684\\u6839\\u5143\\u7D20\\uFF0C\\u521B\\u5EFA container \\u5B9E\\u4F8B root\n  const root = createContainer(\n    container,\n    ConcurrentRoot,\n    null,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n    identifierPrefix,\n    onRecoverableError,\n    transitionCallbacks,\n  );\n  markContainerAsRoot(root.current, container);\n\n  ...\n\t// \\u8FD4\\u56DE\\u4E00\\u4E2A\\u65B0\\u5EFA\\u7684 ReactDOMRoot \\u5B9E\\u4F8B\n  // $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions\n  return new ReactDOMRoot(root);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5176\\u4E2D\\uFF0C \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u88AB\\u8C03\\u7528\\uFF0C\\u521B\\u5EFA \",(0,n.jsx)(e.code,{children:\"FiberRoot\"}),\" **:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`// react/packages/react-reconciler/src/ReactFiberReconciler.old.js\nexport function createContainer(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n  identifierPrefix: string,\n  onRecoverableError: (error: mixed) => void,\n  transitionCallbacks: null | TransitionTracingCallbacks,\n): OpaqueRoot {\n  const hydrate = false;\n  const initialChildren = null;\n  return createFiberRoot(\n    containerInfo,\n    tag,\n    hydrate,\n    initialChildren,\n    hydrationCallbacks,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n    identifierPrefix,\n    onRecoverableError,\n    transitionCallbacks,\n  );\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u901A\\u8FC7\\u6253 log \\u53EF\\u4EE5\\u5F97\\u5230\\uFF0C\\u5176\\u53C2\\u6570\\u5B9E\\u9645\\u503C\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`containerInfo: div#root\ntag: 1 // ConcurrentRoot\nhydrationCallbacks: null \nisStrictMode: false,\nconcurrentUpdatesByDefaultOverride: null\nidentifierPrefix: '',\nonRecoverableError: (error: mixed) => void,\ntransitionCallbacks: null,\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6240\\u4EE5\\uFF0C \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u8FD4\\u56DE\\u7684\\u662F\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\uFF0C\\u5373 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u7684\\u4F5C\\u7528\\u662F\\u5BB9\\u5668\\uFF0C\\u5B58\\u653E\\u5F53\\u524D\\u5E94\\u7528\\u4E00\\u4E9B\\u5168\\u5C40\\u7684\\u4FE1\\u606F\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"createFiberRoot\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createFiberRoot(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrate: boolean,\n  initialChildren: ReactNodeList,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n  // TODO: We have several of these arguments that are conceptually part of the\n  // host config, but because they are passed in at runtime, we have to thread\n  // them through the root constructor. Perhaps we should put them all into a\n  // single type, like a DynamicHostConfig that is defined by the renderer.\n  identifierPrefix: string,\n  onRecoverableError: null | ((error: mixed) => void),\n  transitionCallbacks: null | TransitionTracingCallbacks,\n): FiberRoot {\n  // $FlowFixMe[invalid-constructor] Flow no longer supports calling new on functions\n  const root: FiberRoot = (new FiberRootNode(\n    containerInfo,\n    tag,\n    hydrate,\n    identifierPrefix,\n    onRecoverableError,\n  ): any);\n\n  ...\n\n  // Cyclic construction. This cheats the type system right now because\n  // stateNode is any.\n  const uninitializedFiber = createHostRootFiber(\n    tag,\n    isStrictMode,\n    concurrentUpdatesByDefaultOverride,\n  );\n  root.current = uninitializedFiber;\n  uninitializedFiber.stateNode = root;\n  if (enableCache) {\n    ...\n  } else {\n\t\t// \\u9996\\u6B21\\u6E32\\u67D3\\u5E76\\u65E0 cache\n    const initialState: RootState = {\n      element: initialChildren,\n      isDehydrated: hydrate,\n      cache: (null: any), // not enabled yet\n    };\n    uninitializedFiber.memoizedState = initialState;\n  }\n\n  initializeUpdateQueue(uninitializedFiber);\n\n  return root;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8FD9\\u4E2A\\u51FD\\u6570\\u7B80\\u5316\\u6D41\\u7A0B\\u5C31\\u662F\\u65B0\\u5EFA\\u4E86\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"FiberRootNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\uFF0C\\u5E76\\u5C06\\u5176\\u4F5C\\u4E3A\\u8FD4\\u56DE\\u503C\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`function FiberRootNode(\n  containerInfo,\n  tag,\n  hydrate,\n  identifierPrefix,\n  onRecoverableError,\n) {\n  this.tag = tag;\n  this.containerInfo = containerInfo;\n  this.pendingChildren = null;\n\t...\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5728\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8FD8\\u901A\\u8FC7\",(0,n.jsx)(e.code,{children:\"createHostRootFiber\"}),\" \\u521B\\u5EFA\\u4E86\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684\\u5B9E\\u4F8B\\uFF1A\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createHostRootFiber(\n  tag: RootTag,\n  isStrictMode: boolean,\n  concurrentUpdatesByDefaultOverride: null | boolean,\n): Fiber {\n  let mode;\n  if (tag === ConcurrentRoot) {\n\t\t// \\u8BBE\\u7F6E\\u4E86 ConcurrentMode\\uFF0C\\u542F\\u7528\\u65B0\\u7279\\u6027\n    mode = ConcurrentMode;\n\t  ...\n  } else {\n    mode = NoMode;\n  }\n\t\n\t...\n\n  return createFiber(HostRoot, null, null, mode);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E \\uFF0C\\u5BF9 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u505A\\u4E86\\u4EE5\\u4E0B\\u53CC\\u5411\\u94FE\\u63A5\\uFF1A\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:` root.current = uninitializedFiber;\n uninitializedFiber.stateNode = root;\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u7136\\u540E\\uFF0C\\u505A\\u4E86\",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u7684\\u521D\\u59CB\\u5316\\u5DE5\\u4F5C\\u3002\\u65B0\\u5EFA \",(0,n.jsx)(e.code,{children:\"RootState\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8D4B\\u503C\\u7ED9 \",(0,n.jsx)(e.code,{children:\"uninitializedFibe.memoizedState\"}),\" \\u4E0A\\uFF0C\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"initializeUpdateQueue\"}),\" \\uFF0C\\u5176\\u4E2D\\u65B0\\u5EFA\\u4E86\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"UpdateQueue<State>\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8D4B\\u503C\\u7ED9\",(0,n.jsx)(e.code,{children:\"uninitializedFibe.updateQueue\"}),\" \\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"markContainerAsRoot\"}),\"\\u5B9E\\u9645\\u4E0A\\u5C31\\u662F\\u628A\\u4E0A\\u9762\\u7684 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u8D4B\\u503C\\u7ED9 \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u7684\",(0,n.jsx)(e.code,{children:\"internalContainerInstanceKey\"}),\" \\u5C5E\\u6027\\u3002\\u65B9\\u4FBF\\u901A\\u8FC7\\u5143\\u7D20\\u83B7\\u53D6\\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"fiber\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`function ReactDOMRoot(internalRoot: FiberRoot) {\n  this._internalRoot = internalRoot;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5B9E\\u9645\\u4E0A\\u662F\\u751F\\u6210\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"ReactDomRoot\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u628A\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"createContainer\"}),\" \\u751F\\u6210\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u8D4B\\u503C\\u7ED9\\u4ED6\\u7684 \",(0,n.jsx)(e.code,{children:\"_internalRoot\"}),\" \\u5C5E\\u6027\\uFF0C\\u81F3\\u6B64\\uFF0C\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7ED3\\u675F\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u7ED3\\u8BBA\",children:\"\\u7ED3\\u8BBA\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6240\\u4EE5 createRoot \\u7684\\u7ED3\\u679C\\u662F\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"createRootImp\"}),\" \\u51FD\\u6570\\uFF0C\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"FiberRootNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u662F \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"fiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684  \",(0,n.jsx)(e.code,{children:\"FiberNode\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u5E76\\u4E14\\u5C06\",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u7684  \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\"\\uFF0C\",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"stateNode\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"root\"}),\";\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4FEE\\u6539 \",(0,n.jsx)(e.code,{children:\"div#root\"}),\" \\u7684\\u5C5E\\u6027\",(0,n.jsx)(e.code,{children:\"internalContainerInstanceKey\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6700\\u540E\\u8FD4\\u56DE\\u4E00\\u4E2A\",(0,n.jsx)(e.code,{children:\"ReactDomRoot\"}),\" \\u5B9E\\u4F8B\\uFF0C\\u5B83\\u7684 \",(0,n.jsx)(e.code,{children:\"_internalRoot\"}),\" \\u6307\\u5411 \",(0,n.jsx)(e.code,{children:\"root\\u3002\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{hash:\"\\u96BE\\u70B9\",children:\"\\u96BE\\u70B9\"}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5BF9\\u4E8E\\u4E0A\\u9762\\u7684 \",(0,n.jsx)(e.code,{children:\"root\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"uninitializedFiber\"}),\" \\u53EF\\u4EE5\\u7B80\\u5316\\u79F0\\u4E3A \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"})]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u8868\\u793A\\u6574\\u4E2A React \\u5E94\\u7528\\u7684\\u6839\\u7EC4\\u4EF6\\uFF0C\\u5B83\\u662F \",(0,n.jsx)(e.code,{children:\"ReactFiberRoot\"}),\" \\u7C7B\\u578B\\u7684\\u5BF9\\u8C61\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u8868\\u793A\\u7EC4\\u4EF6\\u6811\\u7684\\u6839\\u8282\\u70B9\\uFF0C\\u5B83\\u662F \",(0,n.jsx)(e.code,{children:\"ReactFiber\"}),\" \\u7C7B\\u578B\\u7684\\u5BF9\\u8C61\\u3002\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u8D1F\\u8D23\\u7BA1\\u7406\\u6574\\u4E2A\\u5E94\\u7528\\u7684\\u7EC4\\u4EF6\\u6811\\uFF0C\\u5B83\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\u5C5E\\u6027\\uFF08\\u6307\\u5411\",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\uFF09 \\uFF0C\\u8868\\u793A\\u7EC4\\u4EF6\\u6811\\u7684\\u6839\\u8282\\u70B9\\u3002\\u5F53\\u521B\\u5EFA\\u4E00\\u4E2A\\u7EC4\\u4EF6\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u4F1A\\u521B\\u5EFA\\u4E00\\u4E2A\\u65B0\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\uFF0C\\u5E76\\u5C06\\u5B83\\u8D4B\\u503C\\u7ED9\\u7EC4\\u4EF6\\u7684 \",(0,n.jsx)(e.code,{children:\"_reactInternalFiber\"}),\" \\u5C5E\\u6027\\u3002\\u5F53\\u7EC4\\u4EF6\\u88AB\\u9500\\u6BC1\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u4F1A\\u91CA\\u653E\\u5BF9\\u5E94\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u8D1F\\u8D23\\u7BA1\\u7406\\u7EC4\\u4EF6\\u6811\\u7684\\u4E00\\u4E2A\\u8282\\u70B9\\u3002\\u5B83\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"children\"}),\" \\u6570\\u7EC4\\uFF0C\\u8868\\u793A\\u8BE5\\u8282\\u70B9\\u7684\\u5B50\\u8282\\u70B9\\uFF1B\\u5F53\\u6DFB\\u52A0\\u6216\\u5220\\u9664\\u5B50\\u8282\\u70B9\\u65F6\\uFF0C\",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u4F1A\\u81EA\\u52A8\\u66F4\\u65B0\\u5176 \",(0,n.jsx)(e.code,{children:\"children\"}),\" \\u6570\\u7EC4\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{hash:\"render\",children:(0,n.jsx)(e.code,{children:\"render\"})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5177\\u4F53\\u628A react \\u7EC4\\u4EF6\\u6E32\\u67D3\\u5230\\u9875\\u9762\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`... = ReactDOMRoot.prototype.render =\n  function (children: ReactNodeList): void {\n    const root = this._internalRoot;\n\t\t...\n    updateContainer(children, root, null, null);\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"this._internalRoot\"}),\" \\u62FF\\u5230\\u4E0A\\u9762 \",(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u7684 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\uFF0C\\u8FDB\\u5165\\u6838\\u5FC3\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"updateConatiner\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// react/packages/react-reconciler/src/ReactFiberReconciler.old.js\nexport function updateContainer(\n  element: ReactNodeList,\n  container: OpaqueRoot,\n  parentComponent: ?React$Component<any, any>,\n  callback: ?Function,\n): Lane {\n  \\xB7\\xB7\\xB7\n\t// 1. \\u62FF\\u5230 rootFiber, \\u5F53\\u524D\\u66F4\\u65B0\\u7684\\u65F6\\u95F4\\u6233 eventTime\\uFF0C\n\t// \\u4EE5\\u53CA\\u66F4\\u65B0\\u7684\\u4F18\\u5148\\u7EA7 lane\\uFF0C\\u5F53\\u524D\\u66F4\\u65B0\\u7684\\u4E0A\\u4E0B\\u6587 context\n  const current = container.current;\n  const eventTime = requestEventTime();\n  const lane = requestUpdateLane(current);\n\n\t// enableSchedulingProfiler \\u4E3A\\u5185\\u90E8\\u6536\\u96C6\\u6027\\u80FD\\u6570\\u636E\\u7684\\u542F\\u52A8\\u5F00\\u5173\\uFF0C\\u53EF\\u4EE5\\u4E0D\\u5FC5\\u7406\\u4F1A\n  if (enableSchedulingProfiler) {\n    markRenderScheduled(lane);\n  }\n\n  const context = getContextForSubtree(parentComponent);\n  if (container.context === null) {\n    container.context = context;\n  } else {\n    container.pendingContext = context;\n  }\n\n  \\xB7\\xB7\\xB7\n\n  // 2. \\u521B\\u5EFA\\u66F4\\u65B0\\u4EFB\\u52A1\n  const update = createUpdate(eventTime, lane);\n  // Caution: React DevTools currently depends on this property\n  // being called \"element\".\n  update.payload = {element};\n\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    \\xB7\\xB7\\xB7\n    update.callback = callback;\n  }\n\n  // 3. update \\u5165\\u961F\\uFF0C\\u8FD4\\u56DE update \\u7684 fiberRoot\n  const root = enqueueUpdate(current, update, lane);\n  if (root !== null) {\n    // 4. \\u544A\\u8BC9 scheduler \\u8981\\u5BF9 fiber \\u8FDB\\u884C\\u5904\\u7406\n    scheduleUpdateOnFiber(root, current, lane, eventTime);\n    // 5. \\u5904\\u7406\\u975E\\u7D27\\u6025\\u66F4\\u65B0 transition\n    entangleTransitions(root, current, lane);\n  }\n\n  return lane;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53C2\\u6570 \",(0,n.jsx)(e.code,{children:\"element\"}),\" \\uFF1A\\u4E3A\\u5C06\\u88AB\\u6E32\\u67D3\\u7684\\u7EC4\\u4EF6\\u6811\\uFF0C\\u4F8B\\u5982 \",(0,n.jsx)(e.code,{children:\"<MyPage/>\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53C2\\u6570 \",(0,n.jsx)(e.code,{children:\"container\"}),\" \\uFF1A \\u4E3A\\u524D\\u4E00\\u6B65\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\u521B\\u5EFA\\u7684 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53D8\\u91CF \",(0,n.jsx)(e.code,{children:\"current\"}),\" \\uFF1A\\u4E3A\\u524D\\u4E00\\u6B65\",(0,n.jsx)(e.code,{children:\"createRoot\"}),\"\\u521B\\u5EFA\\u7684 \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\"\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"requestUpdateLane\"}),\" \\uFF1A\\u6839\\u636E\\u5F53\\u524D\\u7684\\u66F4\\u65B0\\u7C7B\\u578B\\u83B7\\u5F97\\u5176 \",(0,n.jsx)(e.code,{children:\"lane\"}),\" \\u503C\\uFF08\\u4F18\\u5148\\u7EA7\\uFF09\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"getContextForSubtree\"}),\"\\uFF1A\\u83B7\\u53D6\\u7EC4\\u4EF6\\u6811\\u4E2D\\u4E00\\u4E2A\\u7EC4\\u4EF6\\u7684\\u4E0A\\u4E0B\\u6587\\u5BF9\\u8C61\",(0,n.jsx)(e.code,{children:\"context\"}),\" \\uFF0C \\u8FD9\\u4E0D\\u662F\\u6240\\u8C13\\u7684\\u72B6\\u6001\\u7BA1\\u7406\\u65B9\\u6848\\u7684 \",(0,n.jsx)(e.code,{children:\"context\"}),\";\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570 \",(0,n.jsx)(e.code,{children:\"createUpdate\"}),\" \\uFF1A\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5BF9\\u8C61\\uFF0C\\u5C06\\u7EC4\\u4EF6\\u6811\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\"\\uFF1B\",(0,n.jsx)(e.code,{children:\"callback\"}),\" \\u4E3A\\u6E32\\u67D3\\u540E\\u8981\\u6267\\u884C\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"enqueueUpdate\"}),\" \\uFF1A\\u5C06 \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5B58\\u5165\\u66F4\\u65B0\\u961F\\u5217\\uFF0C\\u8FD9\\u91CC\\u662F\\u5B58\\u5728\\u53D8\\u91CF \",(0,n.jsx)(e.code,{children:\"concurrentQueues\"}),\" \\u4E2D\\uFF0C\\u8BE5\\u53D8\\u91CF\\u7528\\u4E8E\\u5B58\\u653E\\u5F53\\u524D\\u6B63\\u5728\\u5904\\u7406\\u7684\\u6E32\\u67D3\\u4EFB\\u52A1\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6838\\u5FC3\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"scheduleUpdateOnFiber\"}),\"  \\uFF1A\\u7528\\u4E8E\\u8C03\\u5EA6\\u5904\\u7406\\u7EC4\\u4EF6\\u7684\\u66F4\\u65B0\\u3002\\u4E5F\\u5C31\\u662F\\u8C03\\u7528 scheduler \\u7684 api\\uFF0C\\u5C06\\u6E32\\u67D3\\u4EFB\\u52A1\\u5C01\\u88C5\\u6210 \",(0,n.jsx)(e.code,{children:\"task\"}),\" \\u7B49\\u5F85\\u88AB\\u6267\\u884C\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u51FD\\u6570\",(0,n.jsx)(e.code,{children:\"entangleTransitions\"}),\" \\uFF1A\\u5904\\u7406 \",(0,n.jsx)(e.code,{children:\"transition\"}),\" \\u7684\\u66F4\\u65B0\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"update\"}),\" \\u5BF9\\u8C61\\uFF0C\\u4ECE\\u521D\\u6B21\\u6E32\\u67D3\\u53EF\\u4EE5\\u770B\\u51FA\\uFF0C\\u7EC4\\u4EF6\\u6811\\uFF08\",(0,n.jsx)(e.code,{children:\"elment\"}),\"\\uFF09\\u88AB\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\" \\u653E\\u7F6E\\u5230\\u5B9E\\u4F8B\\u4E2D\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function createUpdate(eventTime: number, lane: Lane): Update<mixed> {\n  const update: Update<mixed> = {\n    eventTime,\n    lane,\n\n    tag: UpdateState,\n    payload: null,\n    callback: null,\n\n    next: null,\n  };\n  return update;\n}\n`})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`// createRoot \\u4E2D updateQueue \\u7684\\u521D\\u59CB\\u5316\nexport function initializeUpdateQueue<State>(fiber: Fiber): void {\n  const queue: UpdateQueue<State> = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      lanes: NoLanes,\n      hiddenCallbacks: null,\n    },\n    callbacks: null,\n  };\n  fiber.updateQueue = queue;\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\u52A0\\u5165 \",(0,n.jsx)(e.code,{children:\"updateQueue\"})]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-jsx\",children:`export function enqueueUpdate<State>(\n  fiber: Fiber,\n  update: Update<State>,\n  lane: Lane,\n): FiberRoot | null {\n  const updateQueue = fiber.updateQueue;\n  if (updateQueue === null) {\n    // Only occurs if the fiber has been unmounted.\n    return null;\n  }\n\n  const sharedQueue: SharedQueue<State> = (updateQueue: any).shared;\n\n  if (isUnsafeClassRenderPhaseUpdate(fiber)) {\n    // This is an unsafe render phase update. Add directly to the update\n    // queue so we can process it immediately during the current render.\n    const pending = sharedQueue.pending;\n    if (pending === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n    } else {\n      update.next = pending.next;\n      pending.next = update;\n    }\n    sharedQueue.pending = update;\n\n    // Update the childLanes even though we're most likely already rendering\n    // this fiber. This is for backwards compatibility in the case where you\n    // update a different component during render phase than the one that is\n    // currently renderings (a pattern that is accompanied by a warning).\n    return unsafe_markUpdateLaneFromFiberToRoot(fiber, lane);\n  } else {\n    return enqueueConcurrentClassUpdate(fiber, sharedQueue, update, lane);\n  }\n}\n`})}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u603B\\u7ED3\",children:\"\\u603B\\u7ED3\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"createRoot\"}),\" \\u4E2D\\uFF0C\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"fiberRoot\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"rootFiber\"}),\" \\uFF0C\\u5E76\\u521D\\u59CB\\u5316\\u4E86 \",(0,n.jsx)(e.code,{children:\"updateQueue\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"render\"}),\"  \\u4E2D\\uFF0C\\u521B\\u5EFA\\u4E86 \",(0,n.jsx)(e.code,{children:\"update\"}),\" \\uFF0C\\u5E76\\u5C06\\u7EC4\\u4EF6\\u6811\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"payload\"}),\" \\uFF0C\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"scheduleUpdateOnFiber\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{hash:\"\\u4E00\\u4E9B\\u8865\\u5145\",children:\"\\u4E00\\u4E9B\\u8865\\u5145\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8865\\u5145\\u4E00\\u4E9B\\u4E0D\\u662F\\u7279\\u522B\\u91CD\\u8981\\u7684\\u5185\\u5BB9\\u3002\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\uFF0C\\u8FD9\\u91CC\\u662F react \\u5185\\u90E8\\u6982\\u5FF5\\u4E0B\\uFF0C\\u5E76\\u975E\\u51FD\\u6570\\u6982\\u5FF5\\u4E0B\\u7684\\u6267\\u884C\\u4E0A\\u4E0B\\u6587\\u3002\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"NoContext\"}),\" \\u8868\\u793A\\u6CA1\\u6709\\u4E0A\\u4E0B\\u6587\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"BatchedContext\"}),\" \\u8868\\u793A\\u6279\\u91CF\\u66F4\\u65B0\\u4E0A\\u4E0B\\u6587\\uFF0C\\u540C\\u65F6\\u6709\\u591A\\u4E2A setState\\uFF0C\\u6B64\\u65F6\\u4E3A\\u6279\\u91CF\\u66F4\\u65B0\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"RenderContext\"}),\" \\u8868\\u793A\\u6E32\\u67D3\\u4E0A\\u4E0B\\u6587\\uFF0C\\u901A\\u5E38 react \\u6E32\\u67D3\\u5206\\u4E3A render \\u548C commit \\u9636\\u6BB5\\uFF1B\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"CommitContext\"}),` \\u8868\\u793A\\u63D0\\u4EA4\\u4E0A\\u4E0B\\u6587\\u3002\n\\u8FD9\\u4E9B\\u53D8\\u91CF\\u7528\\u4E8E\\u8868\\u793A\\u7EC4\\u4EF6\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\u7684\\u72B6\\u6001\\uFF0C\\u4EE5\\u4FBF\\u4E8E\\u66F4\\u597D\\u5730\\u7BA1\\u7406\\u548C\\u4F18\\u5316\\u3002`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"updateQueue\"}),\"  \\u4E2D\\u8FD8\\u6709 \",(0,n.jsx)(e.code,{children:\"shared\"}),\" \\u5C5E\\u6027\\uFF0C\\u88AB\\u79F0\\u4E3A \",(0,n.jsx)(e.code,{children:\"shareQueue\"}),` \\u3002\n`,(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\"\\u7B80\\u5355\\u8BB2 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u5B58\\u653E\\u5F02\\u6B65\\u4EFB\\u52A1\\uFF0C\",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),` \\u5B58\\u653E\\u540C\\u6B65\\u4EFB\\u52A1\\u3002\n\\u7EC4\\u4EF6\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\uFF0C\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u7EC4\\u4EF6\\u5185\\u90E8\\u7684\\u51FD\\u6570\\uFF08\\u4F8B\\u5982`,(0,n.jsx)(e.code,{children:\"useEffect\"}),\" \\u6216 \",(0,n.jsx)(e.code,{children:\"useCallback\"}),\"\\uFF09\\u3002\\u5B83\\u4EEC\\u901A\\u5E38\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u4EA7\\u751F sideEffect \\u7684\\u4EE3\\u7801\\uFF0C\\u5982\\u8BBE\\u7F6E \",(0,n.jsx)(e.code,{children:\"timer\"}),\"\\uFF0C\\u4FEE\\u6539 \",(0,n.jsx)(e.code,{children:\"DOM\"}),\"\\u3001\\u8C03\\u6574 \",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u7B49\\u3002React \\u901A\\u8FC7\\u5C06 sideEffect \\u5B58\\u50A8\\u5728 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\" \\uFF0C\\u5E76\\u5728\\u9002\\u5F53\\u7684\\u65F6\\u673A\\u6267\\u884C\\u5B83\\u4EEC\\u6765\\u63D0\\u9AD8\\u6027\\u80FD\\u3002\"]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"updateQueue\"}),\"\\uFF1A\\u8FD9\\u4E2A\\u961F\\u5217\\u7528\\u4E8E\\u5B58\\u50A8\\u9700\\u8981\\u5728\\u4E0B\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\u6267\\u884C\\u7684\\u66F4\\u65B0\\u64CD\\u4F5C\\uFF08\\u8FD9\\u91CC\\u662F react \\u4E2D\\u5F02\\u6B65\\u4EFB\\u52A1\\u7684\\u6982\\u5FF5\\uFF0C\\u5373\\u4EA7\\u751F\\u66F4\\u65B0\\u64CD\\u4F5C\\u5728\\u4E0B\\u6B21\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u6267\\u884C\\uFF09\\uFF0C\\u4F8B\\u5982\\u7EC4\\u4EF6\\u7684 \",(0,n.jsx)(e.code,{children:\"state\"}),\" \\u53D1\\u751F\\u53D8\\u5316\\u65F6\\uFF0C\\u5B83\\u4F1A\\u5C06\\u66F4\\u65B0\\u64CD\\u4F5C\\u6DFB\\u52A0\\u5230 \",(0,n.jsx)(e.code,{children:\"updateQueue\"}),\" \\u4E2D\\u3002\\u5728\\u4E0B\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u88AB\\u53D6\\u51FA\\u5E76\\u6267\\u884C\\uFF0C\\u4ECE\\u800C\\u66F4\\u65B0\\u7EC4\\u4EF6\\u7684 UI\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\"\\uFF1A\\u8FD9\\u4E2A\\u961F\\u5217\\u7528\\u4E8E\\u5B58\\u50A8\\u5728\\u5F53\\u524D\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\u6267\\u884C\\u7684\\u540C\\u6B65\\u4EFB\\u52A1\\u3002\\u5F53\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"useEffect\"}),\" \\u6216 \",(0,n.jsx)(e.code,{children:\"useCallback\"}),\" Hook \\u65F6\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u5728\\u7EC4\\u4EF6\\u7684\\u6E32\\u67D3\\u8FC7\\u7A0B\\u4E2D\\u6267\\u884C\\u4E00\\u4E2A\\u51FD\\u6570\\uFF0C\\u8FD9\\u4E2A\\u51FD\\u6570\\u901A\\u5E38\\u4F1A\\u6267\\u884C\\u4E00\\u4E9B\\u4EA7\\u751F sideEffect \\u7684\\u4EE3\\u7801\\u3002\\u8FD9\\u4E9B sideEffect \\u5728\\u7EC4\\u4EF6\\u7684\\u6E32\\u67D3\\u5B8C\\u6210\\u540E\\u624D\\u4F1A\\u6267\\u884C\\uFF0C\\u56E0\\u6B64\\u5B83\\u4EEC\\u662F\\u540C\\u6B65\\u7684\\u3002\\u5F53\\u6267\\u884C\\u5B8C\\u6210\\u540E\\uFF0C\\u5B83\\u4F1A\\u5C06\\u66F4\\u65B0\\u64CD\\u4F5C\\u6DFB\\u52A0\\u5230 \",(0,n.jsx)(e.code,{children:\"sharedQueue\"}),\" \\u4E2D\\u3002\\u5728\\u540C\\u4E00\\u4E2A\\u4E8B\\u4EF6\\u5FAA\\u73AF\\u4E2D\\uFF0C\\u5B83\\u4EEC\\u4F1A\\u88AB\\u53D6\\u51FA\\u5E76\\u6267\\u884C\\uFF0C\\u4ECE\\u800C\\u66F4\\u65B0\\u7EC4\\u4EF6\\u7684 UI\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD9\\u6837\\u505A\\u76EE\\u7684\\u662F\\u66F4\\u6709\\u6548\\u5730\\u7BA1\\u7406\\u548C\\u7EC4\\u7EC7\\u4EFB\\u52A1\\uFF0C\\u4ECE\\u800C\\u63D0\\u9AD8\\u6027\\u80FD\\u3002\"})]})}function C(r={}){let{wrapper:e}=r.components||{};return e?(0,n.jsx)(e,Object.assign({},r,{children:(0,n.jsx)(h,r)})):h(r)}var x=C;return F(y);})();\n;return Component;"},"__N_SSG":true}